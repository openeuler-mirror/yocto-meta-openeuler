<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>调试支持 GDB stub 的 Client OS &mdash; openEuler Embedded在线文档 24.03 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="基于UniProton的RPC服务" href="rpc.html" />
    <link rel="prev" title="跨OS服务" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> openEuler Embedded在线文档
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">介绍与概述</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/index.html">总体介绍</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/index.html">快速上手</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../releases/index.html">版本说明</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../test_data/index.html">测试数据</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">指导手册</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../user_guide/index.html">用户使用指导</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">关键特性指导</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">多OS混合关键性部署框架 (MICA)</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../intro.html">简介</a></li>
<li class="toctree-l4"><a class="reference internal" href="../supported_lists.html">支持列表</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build.html">构建指导</a></li>
<li class="toctree-l4"><a class="reference internal" href="../instruction.html">使用指导</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mica_ctl.html">mica命令与配置文件</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer_guides/index.html">开发者指南</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="index.html">跨OS服务</a><ul class="current">
<li class="toctree-l5 current"><a class="current reference internal" href="#">调试支持 GDB stub 的 Client OS</a></li>
<li class="toctree-l5"><a class="reference internal" href="rpc.html">基于UniProton的RPC服务</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../lopper_devicetree.html">外设分区管理</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../ros.html">嵌入式ROS运行时支持</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../muslc.html">musl libc的支持</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../distributed_softbus.html">分布式软总线</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../preempt_rt.html">软实时系统介绍</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../prebuilt_tool.html">预构建工具特性</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../rust.html">Rust支持</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../qt5_wayland.html">嵌入式图形支持</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../armnn.html">ArmNN的支持</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../clang_llvm.html">clang/llvm 编译工具链支持</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../jailhouse.html">嵌入式分区虚拟机Jailhouse</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../openbmc.html">OpenBMC 镜像构建和使用</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../container/index.html">嵌入式容器相关特性</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../kernelversions.html">内核多版本支持（5.10/6.6）介绍</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../software_package_description.html">当前所支持的软件包</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../bsp/index.html">南向使用指导</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../oebuild/index.html">oebuild使用指导</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../infrastructure/index.html">基础设施指导</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../linux/index.html">其他配置指导</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide/index.html">开发及贡献指导</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/index.html">常见问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../references/index.html">参考文档</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">openEuler Embedded在线文档</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../../user_guide/index.html">用户使用指导</a> &raquo;</li>
          <li><a href="../../index.html">关键特性指导</a> &raquo;</li>
          <li><a href="../index.html">多OS混合关键性部署框架 (MICA)</a> &raquo;</li>
          <li><a href="index.html">跨OS服务</a> &raquo;</li>
      <li>调试支持 GDB stub 的 Client OS</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="gdb-stub-client-os">
<span id="mica-debug"></span><h1>调试支持 GDB stub 的 Client OS<a class="headerlink" href="#gdb-stub-client-os" title="Permalink to this headline">¶</a></h1>
<p>当前仅支持调试运行在树莓派4B（aarch64）和x86工控机（x86_64）的Uniproton。</p>
<section id="buniproton">
<h2>基于树莓派4B调测Uniproton<a class="headerlink" href="#buniproton" title="Permalink to this headline">¶</a></h2>
<p>树莓派4B的具体介绍 <a class="reference internal" href="../../../bsp/arm64/raspberrypi4/index.html#board-raspberrypi4b"><span class="std std-ref">树莓派4B</span></a> 。</p>
<p>树莓派的openeuler-image-mcs构建，参见 <a class="reference internal" href="../../../bsp/arm64/raspberrypi4/uefi.html#raspberrypi4-uefi-guide"><span class="std std-ref">树莓派mcs镜像构建指导</span></a>。
由于需要调试，需要在oebuild构建目录中的conf文件夹下的local.conf文件中添加如下配置：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># Enable Debugging Features, like including gdb binary in the image</span>
<span class="nv">IMAGE_FEATURE</span> <span class="o">+=</span> <span class="s2">&quot;debug-tweaks&quot;</span>
</pre></div>
</div>
<p>当然，也可以在openeuler-image-mcs.bb文件中临时增加上述配置。</p>
<p>编译好了树莓派的openeuler-image-mcs镜像并烧录到sd卡，在树莓派上启动后，配置好UEFI，之后进入系统。</p>
<p>此时，输入如下命令，查看当前系统中支持的RTOS：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ mica status
Name                          Assigned CPU        State               Service
uniproton                     <span class="m">3</span>                   Offline
uniproton-gdb                 <span class="m">3</span>                   Offline
</pre></div>
</div>
<p>其中，uniproton-gdb是支持GDB stub的Uniproton。它的conf文件的路径为
<code class="docutils literal notranslate"><span class="pre">/etc/mica/rpi4-uniproton-gdb.conf</span></code> 。这里，有一个很重要的配置选项 <code class="docutils literal notranslate"><span class="pre">Debug=yes</span></code> ，
表示此实例支持GDB stub。</p>
<p>输入如下命令启动支持GDB stub的Uniproton：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ mica start uniproton-gdb
starting uniproton-gdb...
start uniproton-gdb successfully!
</pre></div>
</div>
<p>此时，可以通过启动GDB Client连接到MICA GDB server，以调测Uniproton内核：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ mica gdb uniproton-gdb
gdb /root/raspi4.elf -ex <span class="s1">&#39;target extended-remote :5678&#39;</span> -ex <span class="s1">&#39;set remote run-packet off&#39;</span> -ex <span class="s1">&#39;set remotetimeout unlimited&#39;</span>
GNU gdb <span class="o">(</span>GDB<span class="o">)</span> <span class="m">14</span>.1
Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2023</span> Free Software Foundation, Inc.
License GPLv3+: GNU GPL version <span class="m">3</span> or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
Type <span class="s2">&quot;show copying&quot;</span> and <span class="s2">&quot;show warranty&quot;</span> <span class="k">for</span> details.
This GDB was configured as <span class="s2">&quot;aarch64-openeuler-linux&quot;</span>.
Type <span class="s2">&quot;show configuration&quot;</span> <span class="k">for</span> configuration details.
For bug reporting instructions, please see:
&lt;https://www.gnu.org/software/gdb/bugs/&gt;.
Find the GDB manual and other documentation resources online at:
    &lt;http://www.gnu.org/software/gdb/documentation/&gt;.

For help, <span class="nb">type</span> <span class="s2">&quot;help&quot;</span>.
Type <span class="s2">&quot;apropos word&quot;</span> to search <span class="k">for</span> commands related to <span class="s2">&quot;word&quot;</span>...
Reading symbols from /root/raspi4.elf...
Remote debugging using :5678
warning: Remote gdbserver does not support determining executable automatically.
RHEL &lt;<span class="o">=</span><span class="m">6</span>.8 and &lt;<span class="o">=</span><span class="m">7</span>.2 versions of gdbserver <span class="k">do</span> not support such automatic executable detection.
The following versions of gdbserver support it:
- Upstream version of gdbserver <span class="o">(</span>unsupported<span class="o">)</span> <span class="m">7</span>.10 or later
- Red Hat Developer Toolset <span class="o">(</span>DTS<span class="o">)</span> version of gdbserver from DTS <span class="m">4</span>.0 or later <span class="o">(</span>only on x86_64<span class="o">)</span>
- RHEL-7.3 versions of gdbserver <span class="o">(</span>on any architecture<span class="o">)</span>
0x000000007b025eb4 <span class="k">in</span> OsGdbArchInit <span class="o">()</span>
Support <span class="k">for</span> the <span class="s1">&#39;vRun&#39;</span> packet on the current remote target is <span class="nb">set</span> to <span class="s2">&quot;off&quot;</span>.
<span class="o">(</span>gdb<span class="o">)</span>
</pre></div>
</div>
<p>第一行打印的gdb命令是输入 <code class="docutils literal notranslate"><span class="pre">mica</span> <span class="pre">gdb</span> <span class="pre">&lt;name&gt;</span></code> 后所实际执行的gdb命令，
用户可以依据此提示进一步调试。之后，用户进入GDB命令行，可以执行相应的GDB命令。
接下来会演示一些当前Uniproton支持的调测命令：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>gdb<span class="o">)</span> b OsTestInit
warning: could not convert <span class="s1">&#39;OsTestInit&#39;</span> from the host encoding <span class="o">(</span>ANSI_X3.4-1968<span class="o">)</span> to UTF-32.
This normally should not happen, please file a bug report.
Breakpoint <span class="m">1</span> at 0x7b007b4c: file /home/zzz/repo/private/UniProton/demos/raspi4/apps/openamp/main.c, line <span class="m">42</span>.
<span class="o">(</span>gdb<span class="o">)</span> c
Continuing.

Breakpoint <span class="m">1</span>, OsTestInit <span class="o">()</span> at /home/zzz/repo/private/UniProton/demos/raspi4/apps/openamp/main.c:42
warning: <span class="m">42</span>     /home/zzz/repo/private/UniProton/demos/raspi4/apps/openamp/main.c: No such file or directory
<span class="o">(</span>gdb<span class="o">)</span> s
<span class="m">43</span>      <span class="k">in</span> /home/zzz/repo/private/UniProton/demos/raspi4/apps/openamp/main.c
<span class="o">(</span>gdb<span class="o">)</span> p param
<span class="nv">$1</span> <span class="o">=</span> <span class="o">{</span><span class="nv">taskEntry</span> <span class="o">=</span> 0x0, <span class="nv">taskPrio</span> <span class="o">=</span> <span class="m">0</span>, <span class="nv">reserved</span> <span class="o">=</span> <span class="m">0</span>, <span class="nv">args</span> <span class="o">=</span> <span class="o">{</span><span class="m">0</span>, <span class="m">0</span>, <span class="m">0</span>, <span class="m">2063689196</span><span class="o">}</span>,
<span class="nv">stackSize</span> <span class="o">=</span> <span class="m">2063629368</span>,
<span class="nv">name</span> <span class="o">=</span> 0x2307b01dd48 &lt;error: Cannot access memory at address 0x2307b01dd48&gt;, <span class="nv">stackAddr</span> <span class="o">=</span> <span class="m">2064460304</span><span class="o">}</span>
<span class="o">(</span>gdb<span class="o">)</span> s
<span class="m">45</span>      <span class="k">in</span> /home/zzz/repo/private/UniProton/demos/raspi4/apps/openamp/main.c
<span class="o">(</span>gdb<span class="o">)</span> p param
<span class="nv">$2</span> <span class="o">=</span> <span class="o">{</span><span class="nv">taskEntry</span> <span class="o">=</span> 0x0, <span class="nv">taskPrio</span> <span class="o">=</span> <span class="m">0</span>, <span class="nv">reserved</span> <span class="o">=</span> <span class="m">0</span>, <span class="nv">args</span> <span class="o">=</span> <span class="o">{</span><span class="m">0</span>, <span class="m">0</span>, <span class="m">0</span>, <span class="m">0</span><span class="o">}</span>, <span class="nv">stackSize</span> <span class="o">=</span> <span class="m">0</span>, <span class="nv">name</span> <span class="o">=</span> 0x0,
<span class="nv">stackAddr</span> <span class="o">=</span> <span class="m">0</span><span class="o">}</span>
<span class="o">(</span>gdb<span class="o">)</span> watch param.taskPrio
Hardware watchpoint <span class="m">2</span>: param.taskPrio
<span class="o">(</span>gdb<span class="o">)</span> c
Continuing.

Hardware watchpoint <span class="m">2</span>: param.taskPrio

Old <span class="nv">value</span> <span class="o">=</span> <span class="m">0</span>
New <span class="nv">value</span> <span class="o">=</span> <span class="m">25</span>
OsTestInit <span class="o">()</span> at /home/zzz/repo/private/UniProton/demos/raspi4/apps/openamp/main.c:48
<span class="m">48</span>      <span class="k">in</span> /home/zzz/repo/private/UniProton/demos/raspi4/apps/openamp/main.c
<span class="o">(</span>gdb<span class="o">)</span> c
Continuing.

Watchpoint <span class="m">2</span> deleted because the program has left the block <span class="k">in</span>
which its expression is valid.
0x000000007b007c54 <span class="k">in</span> PRT_AppInit <span class="o">()</span>
    at /home/zzz/repo/private/UniProton/demos/raspi4/apps/openamp/main.c:86
<span class="m">86</span>      <span class="k">in</span> /home/zzz/repo/private/UniProton/demos/raspi4/apps/openamp/main.c
<span class="o">(</span>gdb<span class="o">)</span> c
Continuing.
^C
Program received signal SIGINT, Interrupt.
0x000000007b01da84 <span class="k">in</span> PRT_SemPend <span class="o">()</span>
<span class="o">(</span>gdb<span class="o">)</span> run
The program being debugged has been started already.
Start it from the beginning? <span class="o">(</span>y or n<span class="o">)</span> y
Starting program: /root/raspi4.elf
warning: Remote gdbserver does not support determining executable automatically.
RHEL &lt;<span class="o">=</span><span class="m">6</span>.8 and &lt;<span class="o">=</span><span class="m">7</span>.2 versions of gdbserver <span class="k">do</span> not support such automatic executable detection.
The following versions of gdbserver support it:
- Upstream version of gdbserver <span class="o">(</span>unsupported<span class="o">)</span> <span class="m">7</span>.10 or later
- Red Hat Developer Toolset <span class="o">(</span>DTS<span class="o">)</span> version of gdbserver from DTS <span class="m">4</span>.0 or later <span class="o">(</span>only on x86_64<span class="o">)</span>
- RHEL-7.3 versions of gdbserver <span class="o">(</span>on any architecture<span class="o">)</span>

Breakpoint <span class="m">1</span>, OsTestInit <span class="o">()</span> at /home/zzz/repo/private/UniProton/demos/raspi4/apps/openamp/main.c:42
warning: <span class="m">42</span>     /home/zzz/repo/private/UniProton/demos/raspi4/apps/openamp/main.c: No such file or directory
<span class="o">(</span>gdb<span class="o">)</span>
</pre></div>
</div>
<ol class="arabic simple">
<li><p>首先，通过 <code class="docutils literal notranslate"><span class="pre">break</span></code> 命令在 <code class="docutils literal notranslate"><span class="pre">OsTestInit</span></code> 函数处设置断点，之后通过 <code class="docutils literal notranslate"><span class="pre">continue</span></code> 命令继续执行。</p></li>
<li><p>在 <code class="docutils literal notranslate"><span class="pre">OsTestInit</span></code> 函数处，通过 <code class="docutils literal notranslate"><span class="pre">print</span></code> 命令查看 <code class="docutils literal notranslate"><span class="pre">param</span></code> 结构体的内容，之后通过 <code class="docutils literal notranslate"><span class="pre">step</span></code> 命令逐行执行。</p></li>
<li><p>在 <code class="docutils literal notranslate"><span class="pre">param.taskPrio</span></code> 变量处，通过 <code class="docutils literal notranslate"><span class="pre">watch</span></code> 命令设置硬件监视点，之后通过 <code class="docutils literal notranslate"><span class="pre">continue</span></code> 命令继续执行。</p></li>
<li><p>在 <code class="docutils literal notranslate"><span class="pre">param.taskPrio</span></code> 变量发生变化时，GDB会停止执行。当代码执行的区域超出了 <code class="docutils literal notranslate"><span class="pre">param.taskPrio</span></code> 变量所处的区域，GDB也会停止执行。</p></li>
<li><p>通过执行 <code class="docutils literal notranslate"><span class="pre">continue</span></code>，RTOS持续运行了起来。 之后可以通过 <code class="docutils literal notranslate"><span class="pre">ctrl-c</span></code> 命令停止执行。</p></li>
<li><p>之后，可以通过 <code class="docutils literal notranslate"><span class="pre">run</span></code> 命令重新加载并启动RTOS，Uniproton会在第一个断点处停止执行。</p></li>
</ol>
<p>输入 <code class="docutils literal notranslate"><span class="pre">quit</span></code> 命令退出GDB调试模式，之后，Uniproton会清除所有断点，并进入正常的运行状态。
之后，如果想停止Uniproton，可以输入如下命令：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ mica stop uniproton-gdb
stopping uniproton-gdb...
stop uniproton-gdb successfully!
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>由于Uniproton在GDB stub方面的具体实现方式，如果Uniproton正在等待GDB client的连接，
它还没有初始化中断，所以在这个阶段，Uniproton不会响应系统停止的指令。
因此，此时发送 <code class="docutils literal notranslate"><span class="pre">mica</span> <span class="pre">stop</span> <span class="pre">&lt;name&gt;</span></code> 命令是无效的。</p>
</div>
</section>
<section id="x86uniproton">
<h2>基于x86工控机调测Uniproton<a class="headerlink" href="#x86uniproton" title="Permalink to this headline">¶</a></h2>
<p>工控机的具体介绍 <a class="reference internal" href="../../../bsp/x86/HVAEIPC-M10/m10.html#hvaepic-m10"><span class="std std-ref">工控机</span></a> 。</p>
<section id="id1">
<h3>相关接口定义<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>首先，对于Client OS而言，需要支持GDB stub。
当前MICA框架仅支持基于简单ring buffer通信的方式进行GDB stub信息的交互，
ring buffer的地址和大小在MCS仓库中 <code class="docutils literal notranslate"><span class="pre">library/include/mcs/mica_debug_ring_buffer.h</span></code> 中定义：</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// x86 ring buffer base address offset and size</span>
<span class="cp">#define RING_BUFFER_SHIFT 0x4000</span>
<span class="cp">#define RING_BUFFER_SIZE 0x1000</span>
</pre></div>
</div>
<p>x86架构下由于ring buffer存在的物理空间的首地址始终相对于Uniproton的入口地址是固定的，
在做内存映射的时候我们ring buffer的首地址可以通过Uniproton的入口地址减去 <code class="docutils literal notranslate"><span class="pre">RING_BUFFER_SHIFT</span></code> 得到。</p>
<p>ring buffer 的定义在 <code class="docutils literal notranslate"><span class="pre">library/include/mcs/ring_buffer.h</span></code> 文件中。</p>
</section>
<section id="id2">
<h3>使用方法<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>首先，需要构建含有MICA的openEuler Embedded镜像，请参考 <a class="reference internal" href="../build.html#mcs-build"><span class="std std-ref">MICA镜像构建指南</span></a> 。</p>
<p>然后，需要生成适配了GDB stub 的 Uniproton，参考 <a class="reference external" href="https://gitee.com/openeuler/UniProton/blob/master/doc/gdbstub.md">UniProton GDB stub 构建指南</a> 。</p>
<p>在运行命令时，需要在启动MICA时加上 <code class="docutils literal notranslate"><span class="pre">-d</span></code> 参数。
并且，由于需要对可执行文件进行调试， <code class="docutils literal notranslate"><span class="pre">-t</span></code> 参数需要指定包含符号表的可执行文件的路径。
一般来说，plain binary format的可执行文件并没有相关调试信息，
所以我们只能使用elf格式的可执行文件进行调试。
当然，如果 <code class="docutils literal notranslate"><span class="pre">-t</span></code> 参数指定的是格式为plain binary format的可执行文件的路径，
调试模式仍然可以正常启动，但是在启动GDB client的时候无法正确读取符号表，
需要用 <code class="docutils literal notranslate"><span class="pre">file</span></code> 命令额外指定包含符号表的可执行文件的路径。</p>
<p>以下是启动MICA调试模式的命令：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>若使用的是标准镜像，则使用mica脚本启动MICA：
<span class="gp">$ </span>mica start /path/to/executable -d
<span class="gp"># </span>若没有mica脚本，则使用如下命令启动MICA：
<span class="gp">$ </span>insmod /path/to/mcs_km.ko <span class="nv">rmem_base</span><span class="o">=</span>0x118000000 <span class="nv">rmem_size</span><span class="o">=</span>0x10000000
<span class="gp"># </span>启动MICA调试模式：
<span class="gp">$ </span>/path/to/mica_main -c <span class="m">3</span> -t /path/to/executable -a 0x118000000 -b /path/to/ap_boot -d
<span class="go">...</span>
<span class="go">MICA gdb proxy server: starting...</span>
<span class="go">GNU gdb (GDB) 12.1</span>
<span class="go">Copyright (C) 2022 Free Software Foundation, Inc.</span>
<span class="go">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</span>
<span class="go">This is free software: you are free to change and redistribute it.</span>
<span class="go">There is NO WARRANTY, to the extent permitted by law.</span>
<span class="go">Type &quot;show copying&quot; and &quot;show warranty&quot; for details.</span>
<span class="go">This GDB was configured as &quot;x86_64-openeuler-linux&quot;.</span>
<span class="go">...</span>
<span class="go">MICA gdb proxy server: read for messages forwarding ...</span>
<span class="gp gp-VirtualEnv">(gdb)</span>
</pre></div>
</div>
<p>此时，用户可以直接通过GDB命令行输入命令与Client OS进行交互。
如果用户想要通过GDB命令行像正常情况一样运行client OS，可以直接不设置断点，输入命令 <code class="docutils literal notranslate"><span class="pre">continue</span></code> 。</p>
<p>按下 <code class="docutils literal notranslate"><span class="pre">ctrl-c</span></code> 之后会返回GDB命令行，此时用户可以输入GDB命令与Client OS进行交互。
如果用户想要退出调试模式，必须在GDB命令行输入 <code class="docutils literal notranslate"><span class="pre">quit</span></code> 命令。之后，
MICA会退出与调试相关的模块，并保留pty application模块，以保持和Client OS通过pty交互的能力。
Uniproton会清除所有断点，并进入正常的运行状态。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>当前Uniproton的GDB stub支持 <code class="docutils literal notranslate"><span class="pre">break</span></code>， <code class="docutils literal notranslate"><span class="pre">continue</span></code>， <code class="docutils literal notranslate"><span class="pre">print</span></code> ，
<code class="docutils literal notranslate"><span class="pre">quit</span></code> ， <code class="docutils literal notranslate"><span class="pre">backtrace</span></code>， <code class="docutils literal notranslate"><span class="pre">watch</span></code>， <code class="docutils literal notranslate"><span class="pre">step</span></code>， <code class="docutils literal notranslate"><span class="pre">run</span></code> 和 <code class="docutils literal notranslate"><span class="pre">ctrl-c</span></code> 九个命令。</p>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="跨OS服务" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="rpc.html" class="btn btn-neutral float-right" title="基于UniProton的RPC服务" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, openEuler Embedded.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: openEuler-24.03-LTS
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Branches</dt>
      <dd><a href="../../../../master/features/mica/services/debug.html">master</a></dd>
      <dd><a href="../../../../openEuler-21.09/index.html">openEuler-21.09</a></dd>
      <dd><a href="../../../../openEuler-22.03-LTS/index.html">openEuler-22.03-LTS</a></dd>
      <dd><a href="../../../../openEuler-22.03-LTS-SP1/index.html">openEuler-22.03-LTS-SP1</a></dd>
      <dd><a href="../../../../openEuler-22.03-LTS-SP2/index.html">openEuler-22.03-LTS-SP2</a></dd>
      <dd><a href="../../../../openEuler-22.03-LTS-SP3/index.html">openEuler-22.03-LTS-SP3</a></dd>
      <dd><a href="../../../../openEuler-22.03-LTS-SP4/index.html">openEuler-22.03-LTS-SP4</a></dd>
      <dd><a href="../../../../openEuler-22.09/index.html">openEuler-22.09</a></dd>
      <dd><a href="../../../../openEuler-23.03/index.html">openEuler-23.03</a></dd>
      <dd><a href="../../../../openEuler-23.09/index.html">openEuler-23.09</a></dd>
      <dd><a href="debug.html">openEuler-24.03-LTS</a></dd>
    </dl>
  </div>
</div>
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>