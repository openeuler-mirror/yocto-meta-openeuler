<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>基于 oebuild 快速构建 &mdash; openEuler Embedded在线文档 1.0.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Yocto介绍" href="overview.html" />
    <link rel="prev" title="Yocto 入门文档二" href="getting_started2.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> openEuler Embedded在线文档
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">内容</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">总体介绍</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">快速上手</a></li>
<li class="toctree-l1"><a class="reference internal" href="../features/index.html">关键特性</a></li>
<li class="toctree-l1"><a class="reference internal" href="../linux/index.html">使用与配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure/index.html">基础设施</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">构建系统</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="getting_started.html">Yocto 入门文档</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting_started2.html">Yocto 入门文档二</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">基于 oebuild 快速构建</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">总体介绍</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">运行环境准备</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#python3pip">安装python3和pip</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">安装oebuild</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id4">如何编译一个标准镜像</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id5">初始化oebuild目录</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">更新oebuild运行环境</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">创建编译配置文件</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id8">执行构建操作</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id9">命令介绍</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#oebuild-init">oebuild init</a></li>
<li class="toctree-l4"><a class="reference internal" href="#oebuild-update">oebuild update</a></li>
<li class="toctree-l4"><a class="reference internal" href="#oebuild-generate">oebuild generate</a></li>
<li class="toctree-l4"><a class="reference internal" href="#oebuild-bitbake">oebuild bitbake</a></li>
<li class="toctree-l4"><a class="reference internal" href="#oebuild-manifest">oebuild manifest</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id10">配置文件介绍</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#config">config</a></li>
<li class="toctree-l4"><a class="reference internal" href="#env">.env</a></li>
<li class="toctree-l4"><a class="reference internal" href="#compile-yaml">compile.yaml</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id11">开发者帮助</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id12">oebuild目录介绍</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setup-py">如何使用setup.py进行调试或打包</a></li>
<li class="toctree-l4"><a class="reference internal" href="#src">src源码介绍</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="overview.html">Yocto介绍</a></li>
<li class="toctree-l2"><a class="reference internal" href="meta-openeuler.html">openeuler层结构及演进策略</a></li>
<li class="toctree-l2"><a class="reference internal" href="exploration.html">深入Yocto</a></li>
<li class="toctree-l2"><a class="reference internal" href="development.html">Yocto开发</a></li>
<li class="toctree-l2"><a class="reference internal" href="addpackage_guide.html">新增软件包指导</a></li>
<li class="toctree-l2"><a class="reference internal" href="container_environment.html">openEuler Embedded 容器环境介绍</a></li>
<li class="toctree-l2"><a class="reference internal" href="priority.html">Yocto 元数据优先级</a></li>
<li class="toctree-l2"><a class="reference internal" href="sstate.html">share state 机制</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../develop_help/index.html">开发帮助</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bsp/index.html">南向支持</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases/index.html">版本说明</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">openEuler Embedded在线文档</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">构建系统</a> &raquo;</li>
      <li>基于 oebuild 快速构建</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="oebuild">
<span id="openeuler-embedded-oebuild"></span><h1>基于 oebuild 快速构建<a class="headerlink" href="#oebuild" title="Permalink to this headline">¶</a></h1>
<section id="id1">
<h2>总体介绍<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>oebuild是openEuler Embedded孵化的一个开源项目，是为了辅助开发openEuler
Embedded项目而衍生的辅助开发工具，是openEuler
Embedded项目健康运行的一个催化剂，目前oebuild主要实现了主体框架，业务只涵盖了构建，将来会涉及到CICD，本地测试，云构建等等，oebuild的使用将不仅仅限于命令行窗口，还会搭载上层IDE来使用。yocto实现了构建的灵活性，但是做应用的定制与实现需要有较高的学习成本与环境成本，oebuild将完全摒弃这些开发羁绊，解放你的双手，只需要几个指令，即可获得你要的应用镜像，你不需要去下载代码，不需要去准备编译环境，如果你要的应用不是特有定制的，甚至不要求你去学习如何修改bb文件，一切都可以交给oebuild来做，而oebuild需要的，仅仅是一个网络而已。对，就这么简单！！！</p>
</section>
<section id="id2">
<h2>运行环境准备<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<section id="python3pip">
<h3>安装python3和pip<a class="headerlink" href="#python3pip" title="Permalink to this headline">¶</a></h3>
<p>通过系统指令安装即可，这里要求要以python3运行oebuild，python3，pip的安装会根据运行系统的不同而不同</p>
<ul class="simple">
<li><p>如果是ubuntu类系统，则通过如下命令安装：</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">python3</span> <span class="n">python3</span><span class="o">-</span><span class="n">pip</span>
</pre></div>
</div>
<ul class="simple">
<li><p>如果是centos，则通过如下命令安装：</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">yum</span> <span class="n">install</span> <span class="n">python3</span> <span class="n">python3</span><span class="o">-</span><span class="n">pip</span>
</pre></div>
</div>
<ul class="simple">
<li><p>如果是suse，则通过如下命令安装：</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">zypper</span> <span class="n">install</span> <span class="n">python3</span> <span class="n">python3</span><span class="o">-</span><span class="n">pip</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>注1：由于版本或名称可能会有所不同，因此在各系统安装python3或pip时，请根据实际环境来安装，例如：有些系统会默认python即python3，有些系统则需要使用python-is-python3包来安装。</p>
<p>注2：如果该系统没有pip包，则可以通过离线方式来安装，预先下载pip包，然后再通过python安装，通过如下命令来完成pip的安装：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">bootstrap</span><span class="o">.</span><span class="n">pypa</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">get</span><span class="o">-</span><span class="n">pip</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">o</span> <span class="n">get</span><span class="o">-</span><span class="n">pip</span><span class="o">.</span><span class="n">py</span>   <span class="c1"># 下载安装脚本</span>
<span class="n">python</span> <span class="n">get</span><span class="o">-</span><span class="n">pip</span><span class="o">.</span><span class="n">py</span>   <span class="c1"># python is python3</span>
</pre></div>
</div>
</div>
</section>
<section id="id3">
<h3>安装oebuild<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>安装完pip后则可以通过以下命令来完成oebuild的安装</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">oebuild</span>
</pre></div>
</div>
<p>oebuild会依赖一些第三方库辅助运行，因此相关的第三方库也会直接被安装，如果在安装过程中显示错误，或报第三方库安装请求失败等，请再次重新运行安装oebuild的命令即可。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>注： 如果安装在安装oebuild时是以root用户执行，则在安装后可以直接运行，如果是以普通用户安装的，则需要注意将普通用户执行路径添加到环境变量中，可以参考以下方式来完成添加：</p>
</div>
<ol class="arabic simple">
<li><p>以普通用户身份打开.bashrc</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~</span> <span class="o">&amp;&amp;</span> <span class="n">vim</span> <span class="o">.</span><span class="n">bashrc</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>在文件末尾查看是否将命令执行路径添加到环境变量中，该路径一般为<code class="docutils literal notranslate"><span class="pre">/home/&lt;user&gt;/.local/bin</span></code>,如果没有，则将以下语句添加到文件末尾</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>export PATH=/home/&lt;user&gt;/.local/bin:$PATH
</pre></div>
</div>
<p>在以上命令行中，<code class="docutils literal notranslate"><span class="pre">&lt;user&gt;</span></code>表示是你此时的用户名，如果不确定，则可以通过执行<code class="docutils literal notranslate"><span class="pre">whoami</span></code>来确定</p>
<ol class="arabic simple">
<li><p>在添加完成后保存退出，vim编辑板的保存推出按键为：先按<code class="docutils literal notranslate"><span class="pre">esc</span></code>，再按<code class="docutils literal notranslate"><span class="pre">shift</span> <span class="pre">+</span> <span class="pre">:</span></code>,最后输入<code class="docutils literal notranslate"><span class="pre">wq</span></code>然后按回车键即可</p></li>
<li><p>退出后还需要刷新以下环境变量，执行以下命令完成环境变量的刷新</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">~/.</span><span class="n">bashrc</span>
</pre></div>
</div>
<p>这样你就可以使用oebuild这个工具了，试着执行一下<code class="docutils literal notranslate"><span class="pre">oebuild</span> <span class="pre">-h</span></code>，看看能否显示oebuild的帮助信息</p>
</section>
</section>
<section id="id4">
<h2>如何编译一个标准镜像<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>这里将介绍如何使用oebuild来进行基于openEuler Embedded项目编译标准的aarch64的qemu应用</p>
<section id="id5">
<h3>初始化oebuild目录<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>运行如下命令完成oebuild的初始化工作：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">oebuild</span> <span class="n">init</span> <span class="o">&lt;</span><span class="n">directory</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>该操作会初始化oebuild的目录，<code class="docutils literal notranslate"><span class="pre">&lt;directory&gt;</span></code>表示要初始化目录的名称</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>注：由于oebuild的运行整体依赖docker环境的运行，因此，如果你本地没有安装docker应用，则请按照oebuild给出的提示进行操作，或者按以下给出的方式完成docker的安装</p>
</div>
<ol class="arabic simple">
<li><p>确定你本机的系统类型，这里以ubuntu为例讲解，执行以下命令完成docker的安装</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">docker</span> <span class="n">docker</span><span class="o">.</span><span class="n">io</span> <span class="o">-</span><span class="n">y</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>添加docker用户组</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">groupadd</span> <span class="n">docker</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>将本用户添加到docker组内</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sudo usermod -a -G docker $(whoami)
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>重新启动docker</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">systemctl</span><span class="o">-</span><span class="n">reload</span> <span class="o">&amp;&amp;</span> <span class="n">systemctl</span> <span class="n">restart</span> <span class="n">docker</span>
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>修改docker.sock读写权限</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">chmod</span> <span class="n">o</span><span class="o">+</span><span class="n">rw</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">docker</span><span class="o">.</span><span class="n">sock</span>
</pre></div>
</div>
<p>其他操作系统请参考ubuntu方式进行</p>
</section>
<section id="id6">
<h3>更新oebuild运行环境<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>运行如下命令来完成初期环境的准备工作：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">oebuild</span> <span class="n">update</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">更新工作主要有两点：</div>
</div>
<ul class="simple">
<li><p>pull相关的运行容器镜像</p></li>
<li><p>从gitee上下载yocto-meta-openeuler仓代码，如果本地没有openeuler相关容器，则在这一步执行会比较漫长，请耐心等待。</p></li>
</ul>
</section>
<section id="id7">
<h3>创建编译配置文件<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>运行如下命令来产生编译配置文件：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">oebuild</span> <span class="n">generate</span>
</pre></div>
</div>
<p>默认配置文件对应的镜像是aarch64标准镜像</p>
</section>
<section id="id8">
<h3>执行构建操作<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>执行如下命令会进入镜像构建程序：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">oebuild</span> <span class="n">bitbake</span> <span class="n">openeuler</span><span class="o">-</span><span class="n">image</span>
</pre></div>
</div>
<p>请耐心等待20分钟，你就可以得到一个标准的openEuler Embedded
aarch64架构的镜像</p>
</section>
</section>
<section id="id9">
<h2>命令介绍<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h2>
<section id="oebuild-init">
<h3>oebuild init<a class="headerlink" href="#oebuild-init" title="Permalink to this headline">¶</a></h3>
<p>目录初始化指令，主要用于初始化oebuild项目目录，运行该指令在后面需要跟要初始化的目录名，通过运行<code class="docutils literal notranslate"><span class="pre">oebuild</span> <span class="pre">init</span> <span class="pre">-h</span></code>来查看帮助信息：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span>

<span class="n">oebuild</span> <span class="n">init</span> <span class="p">[</span><span class="n">directory</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">u</span> <span class="n">yocto_remote_url</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">b</span> <span class="n">branch</span><span class="p">]</span>

<span class="n">Initialize</span> <span class="n">an</span> <span class="n">OEBUILD</span> <span class="n">working</span> <span class="n">directory</span><span class="p">,</span> <span class="ow">and</span> <span class="n">execute</span>
<span class="nb">all</span> <span class="n">other</span> <span class="n">OEbuild</span> <span class="n">instructions</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">initialized</span> <span class="n">directory</span>

<span class="n">positional</span> <span class="n">arguments</span><span class="p">:</span>
<span class="n">directory</span>            <span class="n">The</span> <span class="n">name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">directory</span> <span class="n">that</span> <span class="n">will</span> <span class="n">be</span> <span class="n">initialized</span>

<span class="n">options</span><span class="p">:</span>
<span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>           <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
<span class="o">-</span><span class="n">u</span> <span class="n">YOCTO_REMOTE_URL</span>  <span class="n">Specifies</span> <span class="n">the</span> <span class="n">remote</span> <span class="n">of</span> <span class="n">yocto</span><span class="o">-</span><span class="n">meta</span><span class="o">-</span><span class="n">openeuler</span>
<span class="o">-</span><span class="n">b</span> <span class="n">BRANCH</span>            <span class="n">Specifies</span> <span class="n">the</span> <span class="n">branch</span> <span class="n">of</span> <span class="n">yocto</span><span class="o">-</span><span class="n">meta</span><span class="o">-</span><span class="n">openeuler</span>
</pre></div>
</div>
<p>directory: 表示要初始化的目录名称（注意：我们无法在已经初始化的目录内再次执行初始化操作）</p>
<ul class="simple">
<li><p>-u&lt;yocto_remote_url&gt;：yocto-meta-openeuler的remote远程链接</p></li>
<li><p>-b&lt;branch&gt;：yocto-meta-openeuler的分支</p></li>
</ul>
<p>（注意：oebuild在执行构建任务时是依赖已经适配oebuild的yocto-meta-openeuler的仓的）</p>
<p>例如初始化demo目录只需要执行如下命令：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">oebuild</span> <span class="n">init</span> <span class="n">demo</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">init命令执行后主要执行两个任务：</div>
</div>
<ol class="arabic simple">
<li><p>创建src源码目录，创建.oebuild目录，拷贝config配置文件到.oebuild</p></li>
<li><p>如果设置了-u或-b参数，则对config文件进行相应的修改</p></li>
</ol>
<p>初始化目录后demo的目录结构如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">.</span><span class="n">oebuild</span>
    <span class="n">config</span>
<span class="n">src</span>
</pre></div>
</div>
<ul class="simple">
<li><p>src：该目录用于存放跟编译相关的源码</p></li>
<li><p>.oebuild：目录用于存放全局性配置文件，在oebuild执行初始化后，会看到有一个config配置文件，该配置文件将在搭建编译基础环境时应用到。</p></li>
</ul>
</section>
<section id="oebuild-update">
<h3>oebuild update<a class="headerlink" href="#oebuild-update" title="Permalink to this headline">¶</a></h3>
<p>基础环境更新指令，在执行初始化目录指令后，在执行构建环节之前必须要先执行该命令，通过运行<code class="docutils literal notranslate"><span class="pre">oebuild</span> <span class="pre">update</span> <span class="pre">-h</span></code>来查看帮助信息</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span>
<span class="n">oebuild</span> <span class="n">update</span> <span class="p">[</span><span class="o">-</span><span class="n">t</span> <span class="n">docker_tag</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">l</span> <span class="nb">list</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">i</span> <span class="n">ignore</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">e</span> <span class="n">enable</span><span class="p">]</span>

<span class="n">Update</span> <span class="n">the</span> <span class="n">base</span> <span class="n">environment</span> <span class="n">required</span> <span class="n">at</span> <span class="n">build</span> <span class="n">time</span><span class="p">,</span> <span class="n">such</span> <span class="k">as</span>
<span class="n">updating</span> <span class="n">the</span> <span class="n">necessary</span> <span class="n">docker</span> <span class="n">images</span> <span class="ow">and</span> <span class="n">yocto</span><span class="o">-</span><span class="n">meta</span><span class="o">-</span><span class="n">openeuler</span> <span class="n">repositories</span>

<span class="n">options</span><span class="p">:</span>
<span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>        <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
<span class="o">-</span><span class="n">t</span> <span class="n">DOCKER_TAG</span>     <span class="n">specifying</span> <span class="n">the</span> <span class="o">-</span><span class="n">t</span> <span class="n">parameter</span> <span class="n">will</span> <span class="n">update</span> <span class="n">the</span> <span class="n">corresponding</span> <span class="n">docker</span> <span class="n">image</span>
<span class="o">-</span><span class="n">l</span> <span class="p">{</span><span class="n">docker</span><span class="p">}</span>       <span class="n">specifying</span> <span class="n">the</span> <span class="o">-</span><span class="n">l</span> <span class="n">parameter</span> <span class="n">lists</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">modules</span>
<span class="o">-</span><span class="n">i</span> <span class="p">{</span><span class="n">docker</span><span class="p">,</span><span class="n">meta</span><span class="p">}</span>  <span class="n">specify</span> <span class="n">the</span> <span class="o">-</span><span class="n">i</span> <span class="n">parameter</span> <span class="n">to</span> <span class="n">ignore</span> <span class="n">the</span> <span class="n">corresponding</span> <span class="n">setting</span> <span class="n">when</span> <span class="n">updating</span><span class="p">,</span> <span class="n">when</span> <span class="n">the</span> <span class="o">-</span><span class="n">e</span> <span class="n">parameter</span> <span class="ow">is</span> <span class="n">used</span> <span class="n">at</span> <span class="n">the</span> <span class="n">same</span> <span class="n">time</span><span class="p">,</span> <span class="n">the</span> <span class="o">-</span><span class="n">i</span> <span class="n">parameter</span> <span class="n">no</span> <span class="n">longer</span> <span class="n">takes</span>
                  <span class="n">effect</span>
<span class="o">-</span><span class="n">e</span> <span class="p">{</span><span class="n">docker</span><span class="p">,</span><span class="n">meta</span><span class="p">}</span>  <span class="n">specify</span> <span class="n">the</span> <span class="o">-</span><span class="n">e</span> <span class="n">parameter</span> <span class="n">to</span> <span class="n">enable</span> <span class="n">the</span> <span class="n">corresponding</span> <span class="n">setting</span> <span class="n">when</span> <span class="n">updating</span><span class="p">,</span> <span class="n">when</span> <span class="n">the</span> <span class="o">-</span><span class="n">e</span> <span class="n">parameter</span> <span class="ow">is</span> <span class="n">used</span> <span class="n">at</span> <span class="n">the</span> <span class="n">same</span> <span class="n">time</span><span class="p">,</span> <span class="n">the</span> <span class="o">-</span><span class="n">i</span> <span class="n">parameter</span> <span class="n">no</span> <span class="n">longer</span> <span class="n">takes</span>
                  <span class="n">effect</span>
</pre></div>
</div>
<ul class="simple">
<li><p>-t&lt;docker_tag&gt;：指更新哪个tag的容器</p></li>
<li><p>-l&lt;list&gt;：表示列出可选资源列表，目前只有docker这一项</p></li>
<li><p>-i&lt;ignore&gt;：表示在更新时忽略哪一项，可选的有docker与meta，docker代表容器镜像，meta代表yocto-meta-openeuler仓</p></li>
<li><p>-e&lt;enable&gt;：表示在更新时使能哪一项，可选范围与解释同上</p></li>
</ul>
<p>执行更新操作如下命令：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">oebuild</span> <span class="n">update</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">oebuild执行构建有两个必要的前提：</div>
</div>
<ul class="simple">
<li><p>构建需要的容器</p></li>
<li><p>主构建仓（yocto-meta-openeuler）</p></li>
</ul>
<p>所以更新命令主要以这两部分展开</p>
<p>另外，如果我们有自己的oebuild适配仓，可以在<code class="docutils literal notranslate"><span class="pre">config</span></code>配置文件中修改（该文件在<code class="docutils literal notranslate"><span class="pre">&lt;workspace&gt;/.oebuild</span></code>目录下），如果已经先执行过更新操作，然后再次执行<code class="docutils literal notranslate"><span class="pre">oebuild</span> <span class="pre">update</span></code>会将原有的<code class="docutils literal notranslate"><span class="pre">yocto-meta-openeuler</span></code>做备份，将在工作空间根目录下创建yocto-bak备份目录，然后将备份后的<code class="docutils literal notranslate"><span class="pre">yocto-meta-openeuler</span></code>移动到该目录。更改基础仓在config中的如下字段修改：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">basic_repo</span><span class="p">:</span>
  <span class="n">yocto_meta_openeuler</span><span class="p">:</span>
    <span class="n">path</span><span class="p">:</span> <span class="n">yocto</span><span class="o">-</span><span class="n">meta</span><span class="o">-</span><span class="n">openeuler</span>
    <span class="n">remote_url</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">gitee</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">openeuler</span><span class="o">/</span><span class="n">yocto</span><span class="o">-</span><span class="n">meta</span><span class="o">-</span><span class="n">openeuler</span><span class="o">.</span><span class="n">git</span>
    <span class="n">branch</span><span class="p">:</span> <span class="n">master</span>
</pre></div>
</div>
<p>basic_repo与yocto-meta-openeuler是两个key键，不可以更改，remote_url与branch可以更改成自己已经适配的<code class="docutils literal notranslate"><span class="pre">yocto-meta-openeuler</span></code>仓的参数</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>注：如果我们不输入任何参数，即直接执行<code class="docutils literal notranslate"><span class="pre">oebuild</span> <span class="pre">update</span></code>，则默认更新容器镜像和基础仓</p>
</div>
</section>
<section id="oebuild-generate">
<h3>oebuild generate<a class="headerlink" href="#oebuild-generate" title="Permalink to this headline">¶</a></h3>
<p>创建配置文件指令，而该命令就是用来产生配置文件的，通过运行`oebuild generate -h`来查看帮助信息。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span>

<span class="n">oebuild</span> <span class="n">generate</span> <span class="p">[</span><span class="o">-</span><span class="n">p</span> <span class="n">platform</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">f</span> <span class="n">features</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">t</span> <span class="n">toolchain_dir</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">d</span> <span class="n">build_directory</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">l</span> <span class="nb">list</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">b_in</span> <span class="n">build_in</span><span class="p">]</span>

<span class="nb">compile</span><span class="o">.</span><span class="n">yaml</span> <span class="ow">is</span> <span class="n">generated</span> <span class="n">according</span> <span class="n">to</span> <span class="n">different</span> <span class="n">command</span> <span class="n">parameters</span> <span class="n">by</span> <span class="n">generate</span>

<span class="n">options</span><span class="p">:</span>
<span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
<span class="o">-</span><span class="n">l</span> <span class="p">{</span><span class="n">platform</span><span class="p">,</span><span class="n">feature</span><span class="p">}</span>
                        <span class="k">with</span> <span class="n">platform</span> <span class="n">will</span> <span class="nb">list</span> <span class="n">support</span> <span class="n">archs</span><span class="p">,</span> <span class="k">with</span> <span class="n">feature</span> <span class="n">will</span> <span class="nb">list</span> <span class="n">support</span> <span class="n">features</span>
<span class="o">-</span><span class="n">p</span> <span class="n">PLATFORM</span>           <span class="n">this</span> <span class="n">param</span> <span class="ow">is</span> <span class="k">for</span> <span class="n">arch</span><span class="p">,</span> <span class="k">for</span> <span class="n">example</span> <span class="n">aarch4</span><span class="o">-</span><span class="n">std</span><span class="p">,</span> <span class="n">aarch64</span><span class="o">-</span><span class="n">pro</span> <span class="ow">and</span> <span class="n">so</span> <span class="n">on</span>
<span class="o">-</span><span class="n">s</span> <span class="n">SSTATE_CACHE</span>       <span class="n">this</span> <span class="n">param</span> <span class="ow">is</span> <span class="k">for</span> <span class="n">SSTATE_MIRRORS</span>
<span class="o">-</span><span class="n">s_dir</span> <span class="n">SSTATE_DIR</span>     <span class="n">this</span> <span class="n">param</span> <span class="ow">is</span> <span class="k">for</span> <span class="n">SSTATE_DIR</span>
<span class="o">-</span><span class="n">m</span> <span class="n">TMP_DIR</span>            <span class="n">this</span> <span class="n">param</span> <span class="ow">is</span> <span class="k">for</span> <span class="n">tmp</span> <span class="n">directory</span><span class="p">,</span> <span class="n">the</span> <span class="n">build</span> <span class="n">result</span> <span class="n">will</span> <span class="n">be</span> <span class="n">stored</span> <span class="ow">in</span>
<span class="o">-</span><span class="n">f</span> <span class="n">FEATURES</span>           <span class="n">this</span> <span class="n">param</span> <span class="ow">is</span> <span class="n">feature</span><span class="p">,</span> <span class="n">it</span><span class="s1">&#39;s a reuse command</span>
<span class="o">-</span><span class="n">d</span> <span class="n">DIRECTORY</span>          <span class="n">this</span> <span class="n">param</span> <span class="ow">is</span> <span class="n">build</span> <span class="n">directory</span><span class="p">,</span> <span class="n">the</span> <span class="n">default</span> <span class="ow">is</span> <span class="n">same</span> <span class="n">to</span> <span class="n">platform</span>
<span class="o">-</span><span class="n">t</span> <span class="n">TOOLCHAIN_DIR</span>      <span class="n">this</span> <span class="n">param</span> <span class="ow">is</span> <span class="k">for</span> <span class="n">external</span> <span class="n">toolchain</span> <span class="nb">dir</span><span class="p">,</span> <span class="k">if</span> <span class="n">you</span> <span class="n">want</span> <span class="n">use</span> <span class="n">your</span> <span class="n">own</span> <span class="n">toolchain</span>
<span class="o">-</span><span class="n">n</span> <span class="n">NATIVESDK_DIR</span>      <span class="n">this</span> <span class="n">param</span> <span class="ow">is</span> <span class="k">for</span> <span class="n">external</span> <span class="n">nativesdk</span> <span class="nb">dir</span><span class="p">,</span> <span class="n">the</span> <span class="n">param</span> <span class="n">will</span> <span class="n">be</span> <span class="n">useful</span> <span class="n">when</span> <span class="n">you</span> <span class="n">want</span> <span class="n">to</span> <span class="n">build</span> <span class="ow">in</span> <span class="n">host</span>
<span class="o">-</span><span class="n">dt</span><span class="p">,</span> <span class="o">--</span><span class="n">datetime</span>       <span class="n">this</span> <span class="n">param</span> <span class="ow">is</span> <span class="n">add</span> <span class="n">DATETIME</span> <span class="n">to</span> <span class="n">local</span><span class="o">.</span><span class="n">conf</span><span class="p">,</span> <span class="n">the</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">getting</span> <span class="n">current</span> <span class="n">time</span>
<span class="o">-</span><span class="n">df</span><span class="p">,</span> <span class="o">--</span><span class="n">disable_fetch</span>  <span class="n">this</span> <span class="n">param</span> <span class="ow">is</span> <span class="nb">set</span> <span class="n">openeuler_fetch</span> <span class="ow">in</span> <span class="n">local</span><span class="o">.</span><span class="n">conf</span><span class="p">,</span> <span class="n">the</span> <span class="n">default</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">enable</span><span class="p">,</span> <span class="k">if</span> <span class="nb">set</span> <span class="o">-</span><span class="n">df</span><span class="p">,</span> <span class="n">the</span> <span class="n">OPENEULER_FETCH</span> <span class="n">will</span> <span class="nb">set</span> <span class="n">to</span> <span class="s1">&#39;disable&#39;</span>
<span class="o">-</span><span class="n">b_in</span> <span class="p">{</span><span class="n">docker</span><span class="p">,</span><span class="n">host</span><span class="p">}</span>   <span class="n">This</span> <span class="n">parameter</span> <span class="n">marks</span> <span class="n">the</span> <span class="n">mode</span> <span class="n">at</span> <span class="n">build</span> <span class="n">time</span><span class="p">,</span> <span class="ow">and</span> <span class="ow">is</span> <span class="n">built</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">container</span> <span class="n">by</span> <span class="n">docker</span>
</pre></div>
</div>
<ul class="simple">
<li><p>-l&lt;list&gt;：list参数，有两个可选范围，platform和feature，platform则会列出支持的platform列表，feature则会列出支持的feature列表</p></li>
<li><p>-p&lt;platform&gt;：全称platform，生成配置文件需要的一个参数，默认为aarch64-std</p></li>
<li><p>-s&lt;sstate_cache&gt;：指定外部sstate_cache目录，该目录在构建时会使用</p></li>
<li><p>-s_dir&lt;sstate_dir&gt;：指定sstate_cache目录，该目录在构建时会使用</p></li>
<li><p>-m&lt;tmp_dir&gt;：执行tmp目录，yocto在要求tmp目录不可以存放在nfs系统文件结构下，如果有相关环境可以单独指定该存放目录</p></li>
<li><p>-f&lt;feature&gt;：特性参数，全称feature，生成配置文件需要的一个参数，没有默认值</p></li>
<li><p>-d&lt;directory：初始化的编译目录，如果不设置该参数，则初始化的编译目录和-p参数保持一致</p></li>
<li><p>-t&lt;toolchain_dir&gt;：外部编译链参数，全称toolchain_dir，生成配置文件需要的一个参数，没有默认值，该值表示如果我们不需要系统提供的交叉编译链而选择自己的交叉编译链，则可以选择该参数。</p></li>
<li><p>-n&lt;nativesdk_dir&gt;：外部nativesdk目录参数，可以指定外部nativesdk目录，当构建方式为主机构建时该配置才有效</p></li>
<li><p>-dt&lt;datetime&gt;：在local.conf中设定DATATIME变量，该变量旨在设定构建时间戳</p></li>
<li><p>-df&lt;disable_fetch&gt;：在local.conf中设定 <code class="docutils literal notranslate"><span class="pre">OPENEULER_FETCH</span></code> 变量为 <code class="docutils literal notranslate"><span class="pre">disable</span></code> ，这样构建时将禁用OPENEULER_FETCH功能</p></li>
<li><p>-b_in&lt;build in&gt;：构建方式，目前构建方式有docker与host两种，默认与推荐使用docker构建方式</p></li>
</ul>
<p>oebuild在构建时依赖compile.yaml配置文件来完成构建操作，创建配置文件指令已经属于构建指令内容，该操作将会检查<code class="docutils literal notranslate"><span class="pre">yocto-meta-openeuler</span></code>是否适配了oebuild，检查是否适配的规则便是是否在<code class="docutils literal notranslate"><span class="pre">yocto-meta-openeuler</span></code>根目录创建了<code class="docutils literal notranslate"><span class="pre">.oebuild</span></code>隐藏目录，而<code class="docutils literal notranslate"><span class="pre">-p</span></code>则会解析<code class="docutils literal notranslate"><span class="pre">.oebuild/platform</span></code>下相应的平台配置文件，<code class="docutils literal notranslate"><span class="pre">-f</span></code>参数则会解析<code class="docutils literal notranslate"><span class="pre">.oebuild/feature</span></code>下相应的配置文件，该参数是可以多值传入的，例如如下范例：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">oebuild</span> <span class="n">generate</span> <span class="o">-</span><span class="n">p</span> <span class="n">aarch64</span><span class="o">-</span><span class="n">std</span> <span class="o">-</span><span class="n">f</span> <span class="n">systemd</span> <span class="o">-</span><span class="n">f</span> <span class="n">openeuler</span><span class="o">-</span><span class="n">qt</span>
</pre></div>
</div>
<p>则生成的构建配置文件会涵盖<code class="docutils literal notranslate"><span class="pre">systemd</span> <span class="pre">openeuler-qt</span></code>两者的特性</p>
<p>最终会在编译目录下（在执行完<code class="docutils literal notranslate"><span class="pre">oebuild</span> <span class="pre">generate</span></code>后按提示给出的路径即为编译目录）生成构建配置文件<code class="docutils literal notranslate"><span class="pre">compile.yaml</span></code>,关于该配置文件的详细介绍请参考配置文件介绍中的<code class="docutils literal notranslate"><span class="pre">compile.yaml</span></code>。在下一步的构建流程会解析该配置文件，在此之前，用户可以根据自身特定场景环境来修改配置文件，因为按该<code class="docutils literal notranslate"><span class="pre">oebuild</span> <span class="pre">generate</span></code>指令生成的配置文件仅算作一个参考模板，目的是给用户一个最基本的模板参考用，减少用户学习的成本，使用户能够快速上手。</p>
</section>
<section id="oebuild-bitbake">
<h3>oebuild bitbake<a class="headerlink" href="#oebuild-bitbake" title="Permalink to this headline">¶</a></h3>
<p>构建指令，该指令会解析<code class="docutils literal notranslate"><span class="pre">compile.yaml</span></code>(通过<code class="docutils literal notranslate"><span class="pre">oebuild</span> <span class="pre">generate</span></code>指令生成的)，然后完成构建环境的初始化工作。该命令参数如下：</p>
<p>一般来说，启动后的容器挂在的目录映射关系如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">workspace</span><span class="o">&gt;/</span><span class="n">src</span><span class="p">:</span><span class="o">/</span><span class="n">usr1</span><span class="o">/</span><span class="n">openeuler</span><span class="o">/</span><span class="n">src</span>
<span class="o">&lt;</span><span class="n">workspace</span><span class="o">&gt;/</span><span class="n">build</span><span class="o">/</span><span class="p">:</span><span class="o">/</span><span class="n">usr1</span><span class="o">/</span><span class="n">openeuler</span><span class="o">/</span><span class="n">build</span>
</pre></div>
</div>
<p>如果在<code class="docutils literal notranslate"><span class="pre">compile.yaml</span></code>中有<code class="docutils literal notranslate"><span class="pre">toolchain_dir</span></code>参数，即有用户自定义外部工具链，则会增加一个挂载目录，如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;toolchain_dir&gt;：/usr1/openeuler/native_gcc
</pre></div>
</div>
</section>
<section id="oebuild-manifest">
<h3>oebuild manifest<a class="headerlink" href="#oebuild-manifest" title="Permalink to this headline">¶</a></h3>
<p>manifest相关指令，该指令需要在oebuild工作目录下运行，通过该指令我们可以生成当前src目录下的软件仓清单列表，包含远程仓地址以及版本，也可以通过清单文件将相应的软件仓还原到指定的版本，该指令需要oebuild版本在0.0.11及以上。该命令帮助信息如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span>

<span class="n">oebuild</span> <span class="n">manifest</span> <span class="p">[</span><span class="o">-</span><span class="n">c</span> <span class="n">CREATE</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">r</span> <span class="n">recover</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">m_dir</span> <span class="n">MANIFEST_DIR</span><span class="p">]</span>

<span class="n">manifest</span> <span class="n">provides</span> <span class="n">the</span> <span class="n">manifest</span> <span class="n">function</span> <span class="n">of</span> <span class="n">generating</span> <span class="n">dependent</span>
<span class="n">source</span> <span class="n">repositories</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">build</span> <span class="n">working</span> <span class="n">directory</span><span class="p">,</span> <span class="ow">and</span> <span class="n">can</span> <span class="n">restore</span>
<span class="n">relevant</span> <span class="n">source</span> <span class="n">repositories</span> <span class="n">based</span> <span class="n">on</span> <span class="n">the</span> <span class="n">manifest</span> <span class="n">file</span>

<span class="n">options</span><span class="p">:</span>
<span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>           <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
<span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">--</span><span class="n">create</span>         <span class="n">create</span> <span class="n">manifest</span> <span class="kn">from</span> <span class="nn">oebuild</span> <span class="n">workspace</span> <span class="n">src</span> <span class="n">directory</span>
<span class="o">-</span><span class="n">r</span><span class="p">,</span> <span class="o">--</span><span class="n">recover</span>        <span class="n">restore</span> <span class="n">repo</span> <span class="n">version</span> <span class="n">to</span> <span class="n">oebuild</span> <span class="n">workspace</span> <span class="n">src</span> <span class="n">directory</span> <span class="kn">from</span> <span class="nn">a</span> <span class="n">manifest</span>
<span class="o">-</span><span class="n">m_dir</span> <span class="n">MANIFEST_DIR</span>  <span class="n">specify</span> <span class="n">a</span> <span class="n">manifest</span> <span class="n">path</span> <span class="n">to</span> <span class="n">perform</span> <span class="n">the</span> <span class="n">create</span> <span class="ow">or</span> <span class="n">restore</span> <span class="n">operation</span>
</pre></div>
</div>
<ul class="simple">
<li><p>-c&lt;create&gt;：创建manifest文件标识参数</p></li>
<li><p>-r&lt;restore&gt;：依据manifest文件将软件仓还原到指定的版本</p></li>
<li><p>-m_dir&lt;manifest_dir&gt;：指定manifest路径</p></li>
</ul>
<p>我们在完成镜像构建所有任务后，在oebuild工作目录下运行：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">oebuild</span> <span class="n">manifest</span> <span class="o">-</span><span class="n">c</span> <span class="o">-</span><span class="n">m_dir</span> <span class="n">source_list</span><span class="o">/</span><span class="n">manifest</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
<p>这样，我们就生成当下src目录的软件清单列表，存放路径为&lt;oebuild_workspace&gt;/source_list/manifest.yaml</p>
<p>如果我们需要通过manifest.yaml来复原一个镜像版本，那么按如下步骤进行：</p>
<ol class="arabic simple">
<li><p>通过manifest命令还原软件仓版本，运行如下命令：</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">oebuild</span> <span class="n">manifest</span> <span class="o">-</span><span class="n">r</span> <span class="o">-</span><span class="n">m_dir</span> <span class="o">&lt;</span><span class="n">manifest_dir</span><span class="o">&gt;</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>运行generate命令附带-df&lt;disable_openeuler_fetch&gt;参数，生成配置文件，这样就会关闭OPENEULER_FETCH功能：</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">oebuild</span> <span class="n">generate</span> <span class="o">-</span><span class="n">df</span> <span class="o">...</span>  <span class="c1"># 其他参数按需添加</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>修改compile.yaml文件，在build_in字段下添加如下内容，屏蔽layer层更新：</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">not_use_repos</span><span class="p">:</span> <span class="n">true</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>执行bitbake指令，进入交互模式，然后执行<code class="docutils literal notranslate"><span class="pre">bitbake</span> <span class="pre">openeuler-image</span></code>进行构建</p></li>
</ol>
</section>
</section>
<section id="id10">
<h2>配置文件介绍<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h2>
<p>oebuild在生成后有多个配置文件，每个配置文件的作用域不同，下面将介绍各配置文件存放位置以及内容</p>
<section id="config">
<h3>config<a class="headerlink" href="#config" title="Permalink to this headline">¶</a></h3>
<p>oebuild在外围环境的配置文件,该配置文件存放在oebuild项目根目录下的.oebuild目录中，该配置文件结构如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="p">:</span>
  <span class="n">repo_url</span><span class="p">:</span> <span class="n">swr</span><span class="o">.</span><span class="n">cn</span><span class="o">-</span><span class="n">north</span><span class="o">-</span><span class="mf">4.</span><span class="n">myhuaweicloud</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">openeuler</span><span class="o">-</span><span class="n">embedded</span><span class="o">/</span><span class="n">openeuler</span><span class="o">-</span><span class="n">container</span>
  <span class="n">tag_map</span><span class="p">:</span>
    <span class="n">openEuler</span><span class="o">-</span><span class="mf">22.09</span><span class="p">:</span> <span class="s1">&#39;22.09&#39;</span>
    <span class="n">openEuler</span><span class="o">-</span><span class="mf">22.03</span><span class="o">-</span><span class="n">lts</span><span class="o">-</span><span class="n">sp1</span><span class="p">:</span> <span class="mf">22.03</span><span class="o">-</span><span class="n">lts</span><span class="o">-</span><span class="n">sp1</span>
    <span class="n">master</span><span class="p">:</span> <span class="n">latest</span>
<span class="n">basic_repo</span><span class="p">:</span>
  <span class="n">yocto_meta_openeuler</span><span class="p">:</span>
    <span class="n">path</span><span class="p">:</span> <span class="n">yocto</span><span class="o">-</span><span class="n">meta</span><span class="o">-</span><span class="n">openeuler</span>
    <span class="n">remote_url</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">gitee</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">openeuler</span><span class="o">/</span><span class="n">yocto</span><span class="o">-</span><span class="n">meta</span><span class="o">-</span><span class="n">openeuler</span><span class="o">.</span><span class="n">git</span>
    <span class="n">branch</span><span class="p">:</span> <span class="n">master</span>
</pre></div>
</div>
<p><strong>docker</strong>:
表示构建容器相关信息，在该字段下面所列的容器镜像，在执行<code class="docutils literal notranslate"><span class="pre">oebuild</span> <span class="pre">update</span></code>后会下载相应的容器</p>
<ul class="simple">
<li><p>repo_url：表示openEuler Embedded的docker远程仓地址</p></li>
<li><p>tag_map：表示每个openEuler Embedded版本对用的docker构建容器tag</p></li>
</ul>
<p><strong>basic_repo</strong>:表示基础的repo仓，顾名思义，表示在构建之前是作为底座的角色存在的，在执行<code class="docutils literal notranslate"><span class="pre">oebuild</span> <span class="pre">update</span></code>时会解析config配置文件，然后下载相应的构建代码仓</p>
<ul class="simple">
<li><p>yocto-meta-openeuler：目前oebuild唯一的基础仓</p></li>
<li><p>path：该仓下载的路径名称</p></li>
<li><p>remote_url：该仓的远程地址</p></li>
<li><p>branch：该仓的分支</p></li>
</ul>
</section>
<section id="env">
<h3>.env<a class="headerlink" href="#env" title="Permalink to this headline">¶</a></h3>
<p>编译目录配置文件结构如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">container</span><span class="p">:</span>
    <span class="n">remote</span><span class="p">:</span> <span class="n">xxxxxxxxxxxx</span>
    <span class="n">branch</span><span class="p">:</span> <span class="n">xxxxxxxxxxxx</span>
    <span class="n">short_id</span><span class="p">:</span> <span class="n">xxxxxxxxxx</span>
    <span class="n">volumns</span><span class="p">:</span>
    <span class="o">-</span> <span class="o">/</span><span class="n">xxxxxxxxxxx</span>
    <span class="o">-</span> <span class="o">/</span><span class="n">xxxxxxxxxxx</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">container：表示容器相关配置信息</div>
</div>
<ul class="simple">
<li><p>remote：表示<code class="docutils literal notranslate"><span class="pre">yocto-meta-openeuler</span></code>远程url</p></li>
<li><p>branch：表示<code class="docutils literal notranslate"><span class="pre">yocto-meta-openeuler</span></code>分支信息</p></li>
<li><p>short_id：表示容器ID</p></li>
<li><p>volumns：表示容器挂在的目录映射</p></li>
</ul>
<p>oebuild在执行构建过程中，会解析<code class="docutils literal notranslate"><span class="pre">.env</span></code>配置文件，通过对比环境中的其他参数确定是否重新创建一个新的容器还是启用旧容器，比对的内容包括（remote，branch，volumns)只有这三个参数与要构建的对应参数一致，才会继续拉起旧容器，否则就会创建一个新的容器。另外oebuild也会检查设置的short_id对用的容器是否存在，不存在也会创建一个新的容器。在创建新的容器后，新的配置信息会重新写入到<code class="docutils literal notranslate"><span class="pre">.env</span></code>中</p>
</section>
<section id="compile-yaml">
<h3>compile.yaml<a class="headerlink" href="#compile-yaml" title="Permalink to this headline">¶</a></h3>
<p>构建配置文件，该配置文件结构如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">platform</span><span class="p">:</span> <span class="n">aarch64</span><span class="o">-</span><span class="n">std</span>
<span class="n">machine</span><span class="p">:</span> <span class="n">qemu</span><span class="o">-</span><span class="n">aarch64</span>
<span class="n">toolchain_type</span><span class="p">:</span> <span class="n">EXTERNAL_TOOLCHAIN_aarch64</span>
<span class="n">sdk_dir</span><span class="p">:</span>
<span class="n">toolchain_dir</span><span class="p">:</span>
<span class="n">repos</span><span class="p">:</span>
  <span class="n">yocto</span><span class="o">-</span><span class="n">poky</span><span class="p">:</span>
    <span class="n">url</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">gitee</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">openeuler</span><span class="o">/</span><span class="n">yocto</span><span class="o">-</span><span class="n">poky</span><span class="o">.</span><span class="n">git</span>
    <span class="n">path</span><span class="p">:</span> <span class="n">yocto</span><span class="o">-</span><span class="n">poky</span>
    <span class="n">refspec</span><span class="p">:</span> <span class="n">openEuler</span><span class="o">-</span><span class="mf">22.09</span>

  <span class="n">yocto</span><span class="o">-</span><span class="n">meta</span><span class="o">-</span><span class="n">openembedded</span><span class="p">:</span>
    <span class="n">url</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">gitee</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">openeuler</span><span class="o">/</span><span class="n">yocto</span><span class="o">-</span><span class="n">meta</span><span class="o">-</span><span class="n">openembedded</span><span class="o">.</span><span class="n">git</span>
    <span class="n">path</span><span class="p">:</span> <span class="n">yocto</span><span class="o">-</span><span class="n">meta</span><span class="o">-</span><span class="n">openembedded</span>
    <span class="n">refspec</span><span class="p">:</span> <span class="n">dev_hardknott</span>

  <span class="n">yocto</span><span class="o">-</span><span class="n">meta</span><span class="o">-</span><span class="n">ros</span><span class="p">:</span>
    <span class="n">url</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">gitee</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">openeuler</span><span class="o">/</span><span class="n">yocto</span><span class="o">-</span><span class="n">meta</span><span class="o">-</span><span class="n">ros</span><span class="o">.</span><span class="n">git</span>
    <span class="n">path</span><span class="p">:</span> <span class="n">yocto</span><span class="o">-</span><span class="n">meta</span><span class="o">-</span><span class="n">ros</span>
    <span class="n">refspec</span><span class="p">:</span> <span class="n">dev_hardknott</span>
<span class="n">local_conf</span><span class="p">:</span> <span class="o">|</span>
<span class="o">-</span> <span class="n">xxx</span>
<span class="o">-</span> <span class="n">xxx</span>
<span class="n">layers</span><span class="p">:</span>
<span class="o">-</span> <span class="n">xxx</span>
<span class="o">-</span> <span class="n">xxxx</span>
</pre></div>
</div>
<ul>
<li><p>platform：表示cpu架构，</p></li>
<li><p>machine：表示机器类型</p></li>
<li><p>toolchain_type：表示编译链类型</p></li>
<li><p>sdk_dir：保留字段</p></li>
<li><p>toolchain_dir：表示自定义外部编译链路径，如果在<code class="docutils literal notranslate"><span class="pre">oebuild</span> <span class="pre">generate</span></code>设置了该参数<code class="docutils literal notranslate"><span class="pre">-t</span></code>，则会在<code class="docutils literal notranslate"><span class="pre">compile.yaml</span></code>存在该字段</p></li>
<li><p>repos：表示在初始化构建环境时需要用到的仓</p>
<blockquote>
<div><ul class="simple">
<li><p>url：表示仓的远程地址</p></li>
<li><p>path：表示仓在本地的地址</p></li>
<li><p>refspec：表示仓的版本分支</p></li>
</ul>
</div></blockquote>
</li>
<li><p>local_conf：local.conf替换内容，该值在oebuild执行完oe_init后将替换<code class="docutils literal notranslate"><span class="pre">build/conf/local.conf</span></code>中匹配到的内容</p></li>
<li><p>layers：meta层，该值在oebuild执行完oe_init后将通过调用<code class="docutils literal notranslate"><span class="pre">bitbake-layers</span> <span class="pre">add-layer</span></code>来添加meta层</p></li>
</ul>
</section>
</section>
<section id="id11">
<h2>开发者帮助<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h2>
<p>oebuild项目欢迎广大爱好开发者参与贡献oebuild的发展，为了使开发者更快更好的参与到oebuild的开发工作中来，我们专门写了如下指导。</p>
<section id="id12">
<h3>oebuild目录介绍<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>打开oebuild仓我们可以看到，oebuild一级目录有如下内容：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docs</span>
<span class="n">src</span>
<span class="o">.</span><span class="n">gitignore</span>
<span class="n">MANIFEST</span><span class="o">.</span><span class="ow">in</span>
<span class="n">README</span><span class="o">.</span><span class="n">md</span>
<span class="n">setup</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<ul class="simple">
<li><p>docs：文档目录，该目录用于存放关于oebuild的介绍性信息</p></li>
<li><p>src：核心源码目录，我们真正运行oebuild的核心源码就存放在这里，后续介绍关于参与开发oebuild的详细流程将会详细介绍该目录内容</p></li>
<li><p>.gitignore：git提交忽略的文件，在该文件中通过设置的内容可以在git提交时自动忽略</p></li>
<li><p>MANIFEST.in：该文件为pip在打包时包含额外文件的配置文件，在该文件中的内容将在执行python打包时按规则进行包含</p></li>
<li><p>README.md：简要介绍性文件</p></li>
<li><p>setup.py：python打包入口文件 ，我们最终要打包wheel包就要通过该文件来完成</p></li>
</ul>
</section>
<section id="setup-py">
<h3>如何使用setup.py进行调试或打包<a class="headerlink" href="#setup-py" title="Permalink to this headline">¶</a></h3>
<p>在我们完成相关的开发性工作并进行调试时，将通过setup.py内的相关设置来完成该工作</p>
<p>打开setup.py文件，我们可以看到其内容如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Copyright 2018 Open Source Foundries Limited.</span>
<span class="c1"># Copyright (c) 2020, Nordic Semiconductor ASA</span>
<span class="c1">#</span>
<span class="c1"># SPDX-License-Identifier: Apache-2.0</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">setuptools</span>

<span class="n">SCRIPT_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">SCRIPT_DIR</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;README.md&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">long_description</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;src/oebuild/version.py&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">__version__</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">exec</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="k">assert</span> <span class="n">__version__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

<span class="n">version</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OEBUILD_VERSION&#39;</span><span class="p">,</span> <span class="n">__version__</span><span class="p">)</span>

<span class="n">setuptools</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;oebuild&#39;</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="n">version</span><span class="p">,</span>
    <span class="n">author</span><span class="o">=</span><span class="s1">&#39;alichinese&#39;</span><span class="p">,</span>
    <span class="n">author_email</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">long_description</span><span class="o">=</span><span class="n">long_description</span><span class="p">,</span>
    <span class="c1"># http://docutils.sourceforge.net/FAQ.html#what-s-the-official-mime-type-for-restructuredtext-data</span>
    <span class="n">long_description_content_type</span><span class="o">=</span><span class="s2">&quot;text/x-rst&quot;</span><span class="p">,</span>
    <span class="n">url</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">packages</span><span class="o">=</span><span class="n">setuptools</span><span class="o">.</span><span class="n">find_packages</span><span class="p">(</span><span class="n">where</span><span class="o">=</span><span class="s1">&#39;src&#39;</span><span class="p">),</span>
    <span class="n">package_dir</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="s1">&#39;src&#39;</span><span class="p">},</span>
    <span class="n">include_package_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">classifiers</span><span class="o">=</span><span class="p">[</span>
        <span class="s1">&#39;Programming Language :: Python :: 3&#39;</span><span class="p">,</span>
        <span class="s1">&#39;License :: OSI Approved :: Apache Software License&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Operating System :: POSIX :: Linux&#39;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">install_requires</span><span class="o">=</span><span class="p">[</span>
        <span class="s1">&#39;setuptools&#39;</span><span class="p">,</span>
        <span class="s1">&#39;packaging&#39;</span><span class="p">,</span>
        <span class="s1">&#39;PyYaml&#39;</span><span class="p">,</span>
        <span class="s1">&#39;docker&#39;</span><span class="p">,</span>
        <span class="s1">&#39;GitPython&#39;</span><span class="p">,</span>
        <span class="s1">&#39;colorama&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ruamel.yaml&#39;</span>
    <span class="p">],</span>
    <span class="n">python_requires</span><span class="o">=</span><span class="s1">&#39;&gt;=3.8&#39;</span><span class="p">,</span>
    <span class="n">entry_points</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;console_scripts&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;oebuild = oebuild.app.main:main&#39;</span><span class="p">,)},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>可以看到引入的模块儿有<code class="docutils literal notranslate"><span class="pre">setuptools</span></code>,这个是打包的核心模块儿，关于其他的介绍我们暂且不管，因为对于开发者来说几乎没改动，这里我们着重介绍以下<code class="docutils literal notranslate"><span class="pre">install_requires</span></code>，该设置从字面意思理解就是依赖的必要安装，也就是说oebuild运行要依赖的第三方库，如果我们在后续的oebuild开发过程中有一些其他库的依赖，则需要在这里添加。</p>
<p>在进入oebuild目录后，我们可以执行以下命令进入调试状态：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">e</span> <span class="o">.</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>注：以上命令的运行如果以普通用户运行，需要先确认是否将本地执行路径添加到环境变量<code class="docutils literal notranslate"><span class="pre">PATH</span></code>中，如果以root用户运行则不需要考虑，这样我们可以直接运行oebuild相关指令</p>
<p>这样在后续开发与调试过程中，我们可以随时改代码随时生效</p>
</div>
</section>
<section id="src">
<h3>src源码介绍<a class="headerlink" href="#src" title="Permalink to this headline">¶</a></h3>
<p>正在完善中…</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="getting_started2.html" class="btn btn-neutral float-left" title="Yocto 入门文档二" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="overview.html" class="btn btn-neutral float-right" title="Yocto介绍" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, openEuler Embedded.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: openEuler-23.03
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Branches</dt>
      <dd><a href="../../master/index.html">master</a></dd>
      <dd><a href="../../openEuler-21.09/index.html">openEuler-21.09</a></dd>
      <dd><a href="../../openEuler-22.03-LTS/index.html">openEuler-22.03-LTS</a></dd>
      <dd><a href="../../openEuler-22.03-LTS-SP1/index.html">openEuler-22.03-LTS-SP1</a></dd>
      <dd><a href="../../openEuler-22.03-LTS-SP2/yocto/oebuild.html">openEuler-22.03-LTS-SP2</a></dd>
      <dd><a href="../../openEuler-22.03-LTS-SP3/yocto/oebuild.html">openEuler-22.03-LTS-SP3</a></dd>
      <dd><a href="../../openEuler-22.03-LTS-SP4/yocto/oebuild.html">openEuler-22.03-LTS-SP4</a></dd>
      <dd><a href="../../openEuler-22.09/index.html">openEuler-22.09</a></dd>
      <dd><a href="oebuild.html">openEuler-23.03</a></dd>
      <dd><a href="../../openEuler-23.09/index.html">openEuler-23.09</a></dd>
      <dd><a href="../../openEuler-24.03-LTS/index.html">openEuler-24.03-LTS</a></dd>
    </dl>
  </div>
</div>
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>