<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>支持Rust工具链 &mdash; openEuler Embedded在线文档 1.0.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="嵌入式图形支持" href="qt5_wayland.html" />
    <link rel="prev" title="nativesdk 特性" href="nativesdk.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> openEuler Embedded在线文档
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">介绍与概述</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">总体介绍</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">快速上手</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases/index.html">版本说明</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">常见问题</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">指导手册</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">关键特性</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="software_package_description.html">当前所支持的软件包</a></li>
<li class="toctree-l2"><a class="reference internal" href="mcs.html">混合关键性系统</a></li>
<li class="toctree-l2"><a class="reference internal" href="lopper_devicetree.html">外设分区管理</a></li>
<li class="toctree-l2"><a class="reference internal" href="ros.html">嵌入式ROS运行时支持</a></li>
<li class="toctree-l2"><a class="reference internal" href="muslc.html">musl libc的支持</a></li>
<li class="toctree-l2"><a class="reference internal" href="distributed_softbus.html">分布式软总线</a></li>
<li class="toctree-l2"><a class="reference internal" href="preempt_rt.html">软实时系统介绍</a></li>
<li class="toctree-l2"><a class="reference internal" href="nativesdk.html">nativesdk 特性</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">支持Rust工具链</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">为什么选择Rust</a></li>
<li class="toctree-l3"><a class="reference internal" href="#openeuler-embeddedrust">OpenEuler Embedded对于Rust工具链的支持</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">Rust工具链使用方法</a></li>
<li class="toctree-l3"><a class="reference internal" href="#openeulerrust">为什么没有使用OpenEuler生态中的Rust工具链</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">增加对于新版本Rust工具链的支持</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">鸣谢</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="qt5_wayland.html">嵌入式图形支持</a></li>
<li class="toctree-l2"><a class="reference internal" href="armnn.html">ArmNN的支持</a></li>
<li class="toctree-l2"><a class="reference internal" href="clang_llvm.html">clang/llvm 编译工具链支持</a></li>
<li class="toctree-l2"><a class="reference internal" href="jailhouse.html">轻量级虚拟化工具 Jailhouse</a></li>
<li class="toctree-l2"><a class="reference internal" href="isula.html">iSula容器引擎与container os镜像</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../bsp/index.html">南向支持</a></li>
<li class="toctree-l1"><a class="reference internal" href="../yocto/index.html">构建系统</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop_help/index.html">开发帮助</a></li>
<li class="toctree-l1"><a class="reference internal" href="../linux/index.html">使用与配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure/index.html">基础设施</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">openEuler Embedded在线文档</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">关键特性</a> &raquo;</li>
      <li>支持Rust工具链</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="rust">
<span id="id1"></span><h1>支持Rust工具链<a class="headerlink" href="#rust" title="Permalink to this headline">¶</a></h1>
<p>本章介绍OpenEuler Embedded中对于Rust工具链的支持。</p>
<section id="id2">
<h2>为什么选择Rust<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p><strong>运行效率</strong>：Rust类似C++，提供了零开销抽象、可以深入底层进行优化的能力。因此Rust的运行效率可以达到C++同一级别，高于Go等需要GC的语言。</p></li>
<li><p><strong>内存安全性</strong>：Rust提供了一套基于借用、生命周期等语法用于防止发生内存不安全的行为，编译器会在编译时期就帮助程序员避免大多数错误。</p></li>
<li><p><strong>更好的包管理工具</strong>：Rust提供了Cargo工具用于管理Rust项目的构建、下载依赖与分发等。</p></li>
</ol>
</section>
<section id="openeuler-embeddedrust">
<h2>OpenEuler Embedded对于Rust工具链的支持<a class="headerlink" href="#openeuler-embeddedrust" title="Permalink to this headline">¶</a></h2>
<p>目前OpenEuler Embedded中的Rust工具链主要包含以下组件：</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cargo.bbclass</span></code> ：用于提供yocto构建Rust项目的支持。<code class="docutils literal notranslate"><span class="pre">cargo.bbclass</span></code> 定义了一系列Task用于构建基于Cargo工具组织的Rust项目，同时也定义了一系列变量支持编译的自定义。Rust项目的recipe可以通过继承`cargo`类，定义一些标准变量就可以实现项目的构建与发布。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rustc-bin-cross</span></code> 与 <code class="docutils literal notranslate"><span class="pre">cargo-bin-cross</span></code>：用于引入Rust编译器 <code class="docutils literal notranslate"><span class="pre">rustc</span></code> 和包管理工具 <code class="docutils literal notranslate"><span class="pre">cargo</span></code> 的recipe，目前是通过官方提供的预编译二进制包完成项目搭建。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rust-demo</span></code>：定义了一个简单的Rust项目用于展示工具链的使用方法。</p></li>
</ol>
</section>
<section id="id3">
<h2>Rust工具链使用方法<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>首先新建一个recipe用于存放Rust项目的源代码。以下是一个简单的recipe文件内容：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">inherit cargo</span>
<span class="go">SUMMARY = &quot;Rust simple demo&quot;</span>
<span class="go">DESCRIPTION = &quot;A demo using openeuler Rust toolchain&quot;</span>
<span class="go">LICENSE = &quot;MIT&quot;</span>
<span class="go">LIC_FILES_CHKSUM = &quot;file://${COREBASE}/meta/files/common-licenses/MIT;md5=0835ade698e0bcf8506ecda2f7b4f302&quot;</span>

<span class="go">SRC_URI = &quot;file://demo-src&quot;</span>
<span class="go">S = &quot;${WORKDIR}/demo-src&quot;</span>
<span class="go">SRCREV = &quot;${AUTOREV}&quot;</span>
</pre></div>
</div>
<p>首先最重要的是recipe需要继承cargo类 <code class="docutils literal notranslate"><span class="pre">inherit</span> <span class="pre">cargo</span></code> 这样项目就可以使用Rust工具链去构建安装。之后可以设置yocto常用的变量。</p>
<p>Rust项目应该通过cargo工具进行管理，源代码目录应该遵循以下目录结构：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<dl>
<dt>demo-src</dt><dd><p>├── Cargo.toml</p>
<dl class="simple">
<dt>└── src</dt><dd><p>└── main.rs</p>
</dd>
</dl>
</dd>
</dl>
<p>需要将项目的源文件目录 <code class="docutils literal notranslate"><span class="pre">S</span></code> 设置在Rust项目 <code class="docutils literal notranslate"><span class="pre">Cargo.toml</span></code> 所在目录，否则会报告无法找到 <code class="docutils literal notranslate"><span class="pre">Cargo.toml</span></code> 的错误。需要注意：本例通过 <code class="docutils literal notranslate"><span class="pre">file</span></code> 的方式进行fetch，所以将 <code class="docutils literal notranslate"><span class="pre">S</span></code> 变量设置为fetch后的文件夹目录。如果你使用git方式去fetch源文件，则需要修改 <code class="docutils literal notranslate"><span class="pre">S</span></code> 为 <code class="docutils literal notranslate"><span class="pre">${WORKDIR}/git</span></code> （fetch参数默认时）。</p>
<p>如果Rust项目需要通过 <code class="docutils literal notranslate"><span class="pre">crate-io</span></code> 拉取依赖项， <code class="docutils literal notranslate"><span class="pre">CARGO_CRATES_SOURCE</span></code> 变量提供了一个配置crates替换源的方法，需要设该变量为一个非空值，通过配置该变量的flag进行镜像源的配置，具体可以参考 <a class="reference external" href="https://doc.rust-lang.org/cargo/reference/source-replacement.html">Cargo源配置</a>。下面是使用 <a class="reference external" href="https://mirrors.tuna.tsinghua.edu.cn/help/crates.io-index.git/">TUNA镜像</a> 需要增加的配置：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">CARGO_CRATES_SOURCE = &quot;tuna&quot;</span>
<span class="go">CARGO_CRATES_SOURCE[registry] = &quot;https://mirrors.tuna.tsinghua.edu.cn/git/crates.io-index.git&quot;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 83%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>变量名</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>EXTRA_CARGO_FLAGS</p></td>
<td><p>额外的传递给 <code class="docutils literal notranslate"><span class="pre">cargo</span></code> 的flag</p></td>
</tr>
<tr class="row-odd"><td><p>EXTRA_RUSTFLAGS</p></td>
<td><p>额外的传递给Rust编译器的flag</p></td>
</tr>
<tr class="row-even"><td><p>CARGO_BUILD_TYPE</p></td>
<td><p>构建类型，应该为 <code class="docutils literal notranslate"><span class="pre">&quot;--release&quot;</span></code> 或 <code class="docutils literal notranslate"><span class="pre">&quot;--debug&quot;</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>CARGO_FEATURES</p></td>
<td><p>一个空格划分的列表，代表需要启用的Cargo特性（详见 <code class="docutils literal notranslate"><span class="pre">cargo</span> <span class="pre">build</span> <span class="pre">--feature</span> <span class="pre">...</span></code> 相关信息）</p></td>
</tr>
</tbody>
</table>
</section>
<section id="openeulerrust">
<h2>为什么没有使用OpenEuler生态中的Rust工具链<a class="headerlink" href="#openeulerrust" title="Permalink to this headline">¶</a></h2>
<p>目前OpenEuler源代码 <a class="reference external" href="https://gitee.com/src-openeuler/rust/tree/master/">仓库</a> 中提供了Rust工具链的源代码，OpenEuler发行版也支持安装 <code class="docutils literal notranslate"><span class="pre">rustc</span></code> 与 <code class="docutils literal notranslate"><span class="pre">cargo</span></code> 工具。但是因为以下原因没有使用：</p>
<ol class="arabic simple">
<li><p>完全从源代码构建Rust工具链是比较繁琐的。因为 <code class="docutils literal notranslate"><span class="pre">rustc</span></code> 还需要构建LLVM编译器后端，整个构建的中间文件可以达到10G级别的大小。参考 <a class="reference external" href="https://mp.weixin.qq.com/s/zyC9NFu9SAHYBkD3HTrZYA">面向嵌入式场景的构建系统Yocto应用与思考</a> 中的构建原则，我们更倾向于使用已编译好的包进行构建。</p></li>
<li><p>OpenEuler发行版可以安装Rust工具链，但是在x86平台下只能安装x86的 <code class="docutils literal notranslate"><span class="pre">rust-std</span></code> Rust标准库，如果需要进行交叉编译，还需要安装目标平台的Rust标准库，因此无法通过本机工具的方法构建</p></li>
</ol>
<p>基于以上原因目前使用官方的预编译包。更好的解决办法是OpenEuler可以提供在x86安装不同平台的Rust标准库的方法，这样既能保证同源，也能减少从源码构建的复杂性。</p>
</section>
<section id="id5">
<h2>增加对于新版本Rust工具链的支持<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>如果需要升级Rust工具链，或是需要特定版本的Rust工具链，可以修改 <code class="docutils literal notranslate"><span class="pre">cargo-bin-cross_${PV}.bb</span></code> 和 <code class="docutils literal notranslate"><span class="pre">rustc-bin-cross_${PV}.bb</span></code> 为需要的版本，之后将两个bb文件中的安装包获取地址以及校验码更新即可适配新版本工具链。</p>
</section>
<section id="id6">
<h2>鸣谢<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<p>本特性基于 <a class="reference external" href="https://github.com/rust-embedded/meta-rust-bin">meta-rust-bin</a> 项目进行开发，遵守开源MIT协议。</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="nativesdk.html" class="btn btn-neutral float-left" title="nativesdk 特性" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="qt5_wayland.html" class="btn btn-neutral float-right" title="嵌入式图形支持" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, openEuler Embedded.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: openEuler-22.03-LTS-SP4
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Branches</dt>
      <dd><a href="../../master/features/rust.html">master</a></dd>
      <dd><a href="../../openEuler-21.09/index.html">openEuler-21.09</a></dd>
      <dd><a href="../../openEuler-22.03-LTS/index.html">openEuler-22.03-LTS</a></dd>
      <dd><a href="../../openEuler-22.03-LTS-SP1/index.html">openEuler-22.03-LTS-SP1</a></dd>
      <dd><a href="../../openEuler-22.03-LTS-SP2/features/rust.html">openEuler-22.03-LTS-SP2</a></dd>
      <dd><a href="../../openEuler-22.03-LTS-SP3/features/rust.html">openEuler-22.03-LTS-SP3</a></dd>
      <dd><a href="rust.html">openEuler-22.03-LTS-SP4</a></dd>
      <dd><a href="../../openEuler-22.09/index.html">openEuler-22.09</a></dd>
      <dd><a href="../../openEuler-23.03/features/rust.html">openEuler-23.03</a></dd>
      <dd><a href="../../openEuler-23.09/features/rust.html">openEuler-23.09</a></dd>
      <dd><a href="../../openEuler-24.03-LTS/features/rust.html">openEuler-24.03-LTS</a></dd>
      <dd><a href="../../openEuler-24.09/features/rust.html">openEuler-24.09</a></dd>
      <dd><a href="../../sync-pr2495-openEuler-24.03-LTS-to-master/features/rust.html">sync-pr2495-openEuler-24.03-LTS-to-master</a></dd>
    </dl>
  </div>
</div>
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>