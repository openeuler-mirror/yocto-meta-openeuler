<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>分布式软总线 &mdash; openEuler Embedded在线文档 1.0.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="树莓派4B的支持" href="raspberrypi.html" />
    <link rel="prev" title="多OS混合部署框架" href="mcs.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> openEuler Embedded在线文档
          </a>
              <div class="version">
                openEuler-22.03-LTS-SP1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">内容</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">总体介绍</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">快速上手</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">关键特性</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="software_package_description.html">当前所支持的软件包</a></li>
<li class="toctree-l2"><a class="reference internal" href="mcs.html">多OS混合部署框架</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">分布式软总线</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">特性介绍</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">应用指南</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">可信设备添加</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">全量编译指导</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">限制约束</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="raspberrypi.html">树莓派4B的支持</a></li>
<li class="toctree-l2"><a class="reference internal" href="preempt_rt.html">软实时系统介绍</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../yocto/index.html">构建系统</a></li>
<li class="toctree-l1"><a class="reference internal" href="../qemu/index.html">QEMU仿真器的使用</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commit_msg/index.html">commit提交规范</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute_doc.html">如何撰写并贡献文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security_hardening/index.html">安全加固说明</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases/index.html">版本说明</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bsp/index.html">周边设备和硬件底层软件适配</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network/index.html">网络配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="../republish/index.html">商业发行版发行说明</a></li>
<li class="toctree-l1"><a class="reference internal" href="../test_project/index.html">测试工程</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">openEuler Embedded在线文档</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">关键特性</a> &raquo;</li>
      <li>分布式软总线</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="distributed-softbus">
<span id="id1"></span><h1>分布式软总线<a class="headerlink" href="#distributed-softbus" title="Permalink to this headline">¶</a></h1>
<section id="id2">
<h2>特性介绍<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p><strong>背景</strong></p>
<p>openEuler秉承着打造“数字化基础设施操作系统”的愿景，为促进与OpenHarmony生态的合作与互通，实现端边领域的互通和协同，首次在嵌入式领域引入分布式软总线技术。</p>
<p>分布式软总线是OpenHarmony社区开源的分布式设备通信基座，为设备之间的互通互联提供统一的分布式协同能力，实现设备无感发现和高效传输。</p>
<p>OpenHarmony主要面向强交互等需求的智能终端、物联网终端和工业终端。openEuler主要面向有高可靠、高性能等需求的服务器、边缘计算、云和嵌入式设备，二者各有侧重。通过以分布式软总线为代表的技术进行生态互通，以期实现“1+1&gt;2”的效果，支撑社区用户开拓更广阔的行业空间。</p>
<p><strong>架构</strong></p>
<p>软总线的主要架构如下：</p>
<blockquote>
<div><figure class="align-center">
<img alt="../_images/dsoftbus_architecture.png" src="../_images/dsoftbus_architecture.png" />
</figure>
</div></blockquote>
<p>软总线主体功能分为发现、组网、连接和传输四个基本模块，实现：</p>
<ul class="simple">
<li><p><strong>即插即用</strong>:快速便捷发现周边设备</p></li>
<li><p><strong>自由流转</strong>:各设备间自组网，任意建立业务连接，实现自由通信</p></li>
<li><p><strong>高效传输</strong>:通过wifi、蓝牙设备下软硬件协同最大化发挥硬件传输性能</p></li>
</ul>
<p>软总线南向支持wifi和有线以太网通信，同时后续可持续拓展蓝牙等通信方式。并为北向的分布式应用提供统一的API接口，屏蔽底层通信机制。</p>
<p>软总线依赖于设备认证、IPC、日志和系统参数（SN号）等周边模块，嵌入式系统中将这些依赖模块进行了样板性质的替换，以实现软总线基本功能。实际的周边模块功能实现，还需要用户根据实际业务场景进行丰富和替换，以拓展软总线能力。</p>
</section>
<section id="id3">
<h2>应用指南<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p><strong>部署示意</strong></p>
<p>软总线支持局域网内多设备部署，设备间通过以太网通信。</p>
<p>单设备上分为server和client，二者通过IPC模块进行交互。</p>
<p>单节点上支持多client同时接入单一server。</p>
<blockquote>
<div><figure class="align-center">
<img alt="../_images/dsoftbus_networking.png" src="../_images/dsoftbus_networking.png" />
</figure>
</div></blockquote>
<p><strong>服务端启动</strong></p>
<p>服务端主程序名为softbus_server_main。</p>
<p>如部署模型，软总线通过独立进程部署的方式对外提供服务，通过执行服务端主程序可拉起软总线进程提供对外服务。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">openeuler ~ # softbus_server_main &gt;log.file &amp;</span>
</pre></div>
</div>
<p>1.当服务端被拉起时，会主动通过名为ethX/wifiX的网络设备进行coap广播，对对端设备进行自动探测。</p>
<p>2.当探测到对端设备且对端设备为可信设备时，还会自动组网操作，以便后后续客户端进行快速连接和传输。（“添加可信设备”见后续章节）</p>
<p>3.日志模块可通过重定向接管，有条件者还可通过实现和替换软总线依赖的hilog模块，进行更细致的日志管理。</p>
<p>4.服务端依赖于系统参数模块syspara，以获取设备唯一的UDID。openEuler Embedded预留了/etc/SN的文件接口，作为生成UDID的参数。（SN号可为64字节长度内的任意字符串）</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<ul class="simple">
<li><p>用户请参考部署模型，保证单设备节点上有且仅有唯一的softbus_server_main进程。</p></li>
<li><p>用户需要在启动softbus_server_main前配置/etc/SN，并保证多设备下SN号的唯一性</p></li>
</ul>
</div>
<p><strong>客户端API</strong></p>
<p>softbus客户端API头文件在嵌入式版本提供的sdk中对外开放，可在客户端代码中引用。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span>include <span class="s2">&quot;discovery_service.h&quot;</span>
<span class="gp">#</span>include <span class="s2">&quot;softbus_bus_center.h&quot;</span>
<span class="gp">#</span>include <span class="s2">&quot;session.h&quot;</span>
</pre></div>
</div>
<p>其中：</p>
<p>1.discovery_service.h：发现模块头文件，支持应用主动探测和发布的API如下：</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 29%" />
<col style="width: 71%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>PublishService</p></td>
<td><p>发布特定服务能力</p></td>
</tr>
<tr class="row-even"><td><p>UnPublishService</p></td>
<td><p>取消发布特定服务能力</p></td>
</tr>
<tr class="row-odd"><td><p>StartDiscovery</p></td>
<td><p>订阅/探测特定服务能力</p></td>
</tr>
<tr class="row-even"><td><p>StopDiscovery</p></td>
<td><p>取消订阅特性服务能力</p></td>
</tr>
</tbody>
</table>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>服务能力通过g_capabilityMap数组定义，用户若新增能力需要自定义修改该数组，并重新编译软总线服务端和客户端程序来生效。</p>
</div>
<p>2.softbus_bus_center.h：组网模块头文件，支持获取组网内设备信息API如下：</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 29%" />
<col style="width: 71%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>GetAllNodeDeviceInfo</p></td>
<td><p>获取当前组网内所有节点信息</p></td>
</tr>
<tr class="row-even"><td><p>FreeNodeInfo</p></td>
<td><p>释放GetAllNodeDeviceInfo返回的节点信息内存</p></td>
</tr>
</tbody>
</table>
<p>3.session.h：连接/传输模块头文件，支持创建session和数据传输API如下：</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 29%" />
<col style="width: 71%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>CreateSessionServer</p></td>
<td><p>创建session服务端</p></td>
</tr>
<tr class="row-even"><td><p>RemoveSessionServer</p></td>
<td><p>移除session服务端</p></td>
</tr>
<tr class="row-odd"><td><p>OpenSession</p></td>
<td><p>创建到对端的传输连接（同时依赖于本端和对端提前创建的SessionServer）</p></td>
</tr>
<tr class="row-even"><td><p>CloseSession</p></td>
<td><p>断开传输连接</p></td>
</tr>
<tr class="row-odd"><td><p>SendBytes</p></td>
<td><p>根据建好的连接ID，进行字节流数据传输</p></td>
</tr>
<tr class="row-even"><td><p>SendMessage</p></td>
<td><p>根据建好的连接ID，进行消息数据传输</p></td>
</tr>
</tbody>
</table>
<p>各API参数详见头文件描述。</p>
<p><strong>客户端使用</strong></p>
<dl class="simple">
<dt>客户端提供动态链接库：</dt><dd><ul class="simple">
<li><p>libsoftbus_client.z.so，</p></li>
</ul>
</dd>
</dl>
<p>以及对应的头文件:</p>
<blockquote>
<div><ul class="simple">
<li><p>发现：discovery_service.h</p></li>
<li><p>组网：softbus_bus_center.h</p></li>
<li><p>连接/组网：session.h</p></li>
</ul>
</div></blockquote>
<p>用户使用软总线时，需要作为客户端程序显式链接libsoftbus_client.z.so动态库，即可通过函数调用使用软总线提供的API。</p>
<p>链接动态库方式参见下一章节（应用示例）</p>
<p><strong>应用示例</strong></p>
<p>使用qemu部署分布式软总线，编写客户端程序，使其能够列出所有发现的设备信息。</p>
<ol class="arabic">
<li><p>编写客户端程序</p>
<blockquote>
<div><p>编写客户端程序依托于embedded版本发布的SDK，请参考 <a class="reference internal" href="../getting_started/index.html#getting-started"><span class="std std-ref">快速上手</span></a> 章节进行SDK环境使用准备</p>
<p>该示例代码中同时实现了两个设备间的发现和消息收发功能。用户可以作为API调用参考，并根据应用场景进行裁减和扩展。</p>
<p>创建一个 <code class="file docutils literal notranslate"><span class="pre">softbus_client_main.c</span></code> 文件，源码如下：</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;securec.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;discovery_service.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;softbus_bus_center.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;session.h&quot;</span><span class="cp"></span>

<span class="cp">#define PACKAGE_NAME &quot;softbus_sample&quot;</span>
<span class="cp">#define LOCAL_SESSION_NAME &quot;session_test&quot;</span>
<span class="cp">#define TARGET_SESSION_NAME &quot;session_test&quot;</span>
<span class="cp">#define DEFAULT_CAPABILITY &quot;osdCapability&quot;</span>
<span class="cp">#define DEFAULT_SESSION_GROUP &quot;group_test&quot;</span>
<span class="cp">#define DEFAULT_PUBLISH_ID 123</span>

<span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">g_sessionId</span><span class="p">;</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">PublishSuccess</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">publishId</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;&lt;PublishSuccess&gt;CB: publish %d done</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">publishId</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">PublishFailed</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">publishId</span><span class="p">,</span><span class="w"> </span><span class="n">PublishFailReason</span><span class="w"> </span><span class="n">reason</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;&lt;PublishFailed&gt;CB: publish %d failed, reason=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">publishId</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">reason</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">PublishServiceInterface</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">PublishInfo</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">publishId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_PUBLISH_ID</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DISCOVER_MODE_PASSIVE</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">medium</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">COAP</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">freq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LOW</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">capability</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_CAPABILITY</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">capabilityData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">dataLen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="n">IPublishCallback</span><span class="w"> </span><span class="n">cb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">OnPublishSuccess</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PublishSuccess</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">OnPublishFail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PublishFailed</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">PublishService</span><span class="p">(</span><span class="n">PACKAGE_NAME</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">info</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cb</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">UnPublishServiceInterface</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UnPublishService</span><span class="p">(</span><span class="n">PACKAGE_NAME</span><span class="p">,</span><span class="w"> </span><span class="n">DEFAULT_PUBLISH_ID</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;UnPublishService fail:%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ret</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">DeviceFound</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">DeviceInfo</span><span class="w"> </span><span class="o">*</span><span class="n">device</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;&lt;DeviceFound&gt;CB: Device has found</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">devId=%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">device</span><span class="o">-&gt;</span><span class="n">devId</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">devName=%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">device</span><span class="o">-&gt;</span><span class="n">devName</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">devType=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">device</span><span class="o">-&gt;</span><span class="n">devType</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">addrNum=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">device</span><span class="o">-&gt;</span><span class="n">addrNum</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">device</span><span class="o">-&gt;</span><span class="n">addrNum</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t\t</span><span class="s">addr%d:type=%d,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">device</span><span class="o">-&gt;</span><span class="n">addr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">type</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">device</span><span class="o">-&gt;</span><span class="n">addr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="nl">CONNECTION_ADDR_WLAN</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="nl">CONNECTION_ADDR_ETH</span><span class="p">:</span><span class="w"></span>
<span class="w">                        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;ip=%s,port=%d,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">device</span><span class="o">-&gt;</span><span class="n">addr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">info</span><span class="p">.</span><span class="n">ip</span><span class="p">.</span><span class="n">ip</span><span class="p">,</span><span class="w"> </span><span class="n">device</span><span class="o">-&gt;</span><span class="n">addr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">info</span><span class="p">.</span><span class="n">ip</span><span class="p">.</span><span class="n">port</span><span class="p">);</span><span class="w"></span>
<span class="w">                        </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="k">default</span><span class="o">:</span><span class="w"></span>
<span class="w">                        </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;peerUid=%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">device</span><span class="o">-&gt;</span><span class="n">addr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">peerUid</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">capabilityBitmapNum=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">device</span><span class="o">-&gt;</span><span class="n">capabilityBitmapNum</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">device</span><span class="o">-&gt;</span><span class="n">addrNum</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t\t</span><span class="s">capabilityBitmap[%d]=0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">device</span><span class="o">-&gt;</span><span class="n">capabilityBitmap</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">custData=%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">device</span><span class="o">-&gt;</span><span class="n">custData</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">DiscoverySuccess</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">subscribeId</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;&lt;DiscoverySuccess&gt;CB: discover subscribeId=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">subscribeId</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">DiscoveryFailed</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">subscribeId</span><span class="p">,</span><span class="w"> </span><span class="n">DiscoveryFailReason</span><span class="w"> </span><span class="n">reason</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;&lt;DiscoveryFailed&gt;CB: discover subscribeId=%d failed, reason=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">subscribeId</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">reason</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">DiscoveryInterface</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">SubscribeInfo</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">subscribeId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_PUBLISH_ID</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DISCOVER_MODE_ACTIVE</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">medium</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">COAP</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">freq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LOW</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">isSameAccount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">isWakeRemote</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">capability</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_CAPABILITY</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">capabilityData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">dataLen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="n">IDiscoveryCallback</span><span class="w"> </span><span class="n">cb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">OnDeviceFound</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DeviceFound</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">OnDiscoverFailed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DiscoveryFailed</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">OnDiscoverySuccess</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DiscoverySuccess</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">StartDiscovery</span><span class="p">(</span><span class="n">PACKAGE_NAME</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">info</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cb</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">StopDiscoveryInterface</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StopDiscovery</span><span class="p">(</span><span class="n">PACKAGE_NAME</span><span class="p">,</span><span class="w"> </span><span class="n">DEFAULT_PUBLISH_ID</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;StopDiscovery fail:%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ret</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">SessionOpened</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">sessionId</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;&lt;SessionOpened&gt;CB: session %d open fail:%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">sessionId</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">g_sessionId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sessionId</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">SessionClosed</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">sessionId</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;&lt;SessionClosed&gt;CB: session %d closed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">sessionId</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">ByteRecived</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">sessionId</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">dataLen</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;&lt;ByteRecived&gt;CB: session %d received %u bytes data=%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">sessionId</span><span class="p">,</span><span class="w"> </span><span class="n">dataLen</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">data</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">MessageReceived</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">sessionId</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">dataLen</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;&lt;MessageReceived&gt;CB: session %d received %u bytes message=%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">sessionId</span><span class="p">,</span><span class="w"> </span><span class="n">dataLen</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">data</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">CreateSessionServerInterface</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">ISessionListener</span><span class="w"> </span><span class="n">sessionCB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">OnSessionOpened</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SessionOpened</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">OnSessionClosed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SessionClosed</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">OnBytesReceived</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ByteRecived</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">OnMessageReceived</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MessageReceived</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="p">};</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">CreateSessionServer</span><span class="p">(</span><span class="n">PACKAGE_NAME</span><span class="p">,</span><span class="w"> </span><span class="n">LOCAL_SESSION_NAME</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sessionCB</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">RemoveSessionServerInterface</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RemoveSessionServer</span><span class="p">(</span><span class="n">PACKAGE_NAME</span><span class="p">,</span><span class="w"> </span><span class="n">LOCAL_SESSION_NAME</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;RemoveSessionServer fail:%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ret</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">OpenSessionInterface</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">peerNetworkId</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">SessionAttribute</span><span class="w"> </span><span class="n">attr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">dataType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TYPE_BYTES</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">linkTypeNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">linkType</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LINK_TYPE_WIFI_WLAN_2G</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="n">attr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">RAW_STREAM</span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">};</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">OpenSession</span><span class="p">(</span><span class="n">LOCAL_SESSION_NAME</span><span class="p">,</span><span class="w"> </span><span class="n">TARGET_SESSION_NAME</span><span class="p">,</span><span class="w"> </span><span class="n">peerNetworkId</span><span class="p">,</span><span class="w"> </span><span class="n">DEFAULT_SESSION_GROUP</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">attr</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">CloseSessionInterface</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">sessionId</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">CloseSession</span><span class="p">(</span><span class="n">sessionId</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">GetAllNodeDeviceInfoInterface</span><span class="p">(</span><span class="n">NodeBasicInfo</span><span class="w"> </span><span class="o">**</span><span class="n">dev</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">ret</span><span class="p">,</span><span class="w"> </span><span class="n">num</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetAllNodeDeviceInfo</span><span class="p">(</span><span class="n">PACKAGE_NAME</span><span class="p">,</span><span class="w"> </span><span class="n">dev</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">num</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;GetAllNodeDeviceInfo fail:%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ret</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;&lt;GetAllNodeDeviceInfo&gt;return %d Node</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">num</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">num</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">FreeNodeInfoInterface</span><span class="p">(</span><span class="n">NodeBasicInfo</span><span class="w"> </span><span class="o">*</span><span class="n">dev</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">FreeNodeInfo</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">commnunicate</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">NodeBasicInfo</span><span class="w"> </span><span class="o">*</span><span class="n">dev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">char</span><span class="w"> </span><span class="n">cData</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;hello world test&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">dev_num</span><span class="p">,</span><span class="w"> </span><span class="n">sessionId</span><span class="p">,</span><span class="w"> </span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="n">dev_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetAllNodeDeviceInfoInterface</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dev_num</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">dev_num</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;&lt;num %d&gt;deviceName=%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">dev</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">deviceName</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">networkId=%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">dev</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">networkId</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">Type=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">dev</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">deviceTypeId</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Input Node num to commnunication:&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">scanf_s</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">input</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">input</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">dev_num</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;error input num</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="k">goto</span><span class="w"> </span><span class="n">err_input</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="n">g_sessionId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">sessionId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OpenSessionInterface</span><span class="p">(</span><span class="n">dev</span><span class="p">[</span><span class="n">input</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">].</span><span class="n">networkId</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sessionId</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;OpenSessionInterface fail, ret=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">sessionId</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="k">goto</span><span class="w"> </span><span class="n">err_OpenSessionInterface</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">g_sessionId</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">sessionId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                        </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SendBytes</span><span class="p">(</span><span class="n">sessionId</span><span class="p">,</span><span class="w"> </span><span class="n">cData</span><span class="p">,</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">cData</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;SendBytes fail:%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ret</span><span class="p">);</span><span class="w"></span>
<span class="w">                        </span><span class="p">}</span><span class="w"></span>
<span class="w">                        </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">                </span><span class="n">timeout</span><span class="o">--</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="n">CloseSessionInterface</span><span class="p">(</span><span class="n">sessionId</span><span class="p">);</span><span class="w"></span>
<span class="nl">err_OpenSessionInterface</span><span class="p">:</span><span class="w"></span>
<span class="nl">err_input</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="n">FreeNodeInfoInterface</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">loop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateSessionServerInterface</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;CreateSessionServer fail, ret=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ret</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PublishServiceInterface</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;PublishService fail, ret=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ret</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="k">goto</span><span class="w"> </span><span class="n">err_PublishServiceInterface</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DiscoveryInterface</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;DiscoveryInterface fail, ret=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ret</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="k">goto</span><span class="w"> </span><span class="n">err_DiscoveryInterface</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">loop</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Input c to commnuication, Input s to stop:&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="kt">char</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getchar</span><span class="p">();</span><span class="w"></span>
<span class="w">                </span><span class="k">switch</span><span class="p">(</span><span class="n">op</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;c&#39;</span><span class="o">:</span><span class="w"></span>
<span class="w">                        </span><span class="n">commnunicate</span><span class="p">();</span><span class="w"></span>
<span class="w">                        </span><span class="k">continue</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;s&#39;</span><span class="o">:</span><span class="w"></span>
<span class="w">                        </span><span class="n">loop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="w">                        </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="o">:</span><span class="w"></span>
<span class="w">                        </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="k">default</span><span class="o">:</span><span class="w"></span>
<span class="w">                        </span><span class="k">continue</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="n">StopDiscoveryInterface</span><span class="p">();</span><span class="w"></span>
<span class="nl">err_DiscoveryInterface</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="n">UnPublishServiceInterface</span><span class="p">();</span><span class="w"></span>
<span class="nl">err_PublishServiceInterface</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="n">RemoveSessionServerInterface</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>在配置好SDK环境 编译客户端主程序如下：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span><span class="o">{</span>CC<span class="o">}</span> -lsoftbus_client.z -lsec_shared.z softbus_client_main.c -o softbus_client_main
</pre></div>
</div>
<p>编译完成后会得到dsoftbus_client_main程序</p>
</div></blockquote>
</li>
<li><p>构建qemu组网环境</p>
<blockquote>
<div><p>在host中创建网桥br0</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">brctl addbr br0</span>
</pre></div>
</div>
<p>启动qemu1</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">qemu-system-aarch64 -M virt-4.0 -m 1G -cpu cortex-a57 -nographic -kernel zImage -initrd &lt;openeuler-image-qemu-xxx.cpio.gz&gt; -device virtio-net-device,netdev=tap0,mac=52:54:00:12:34:56 -netdev bridge,id=tap0</span>
</pre></div>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>首次运行如果出现如下错误提示，</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">failed to parse default acl file `/usr/local/libexec/../etc/qemu/bridge.conf&#39;</span>
<span class="go">qemu-system-aarch64: bridge helper failed</span>
</pre></div>
</div>
<p>则需要向指示的文件添加”allow br0”</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">echo &quot;allow br0&quot; &gt; /usr/local/libexec/../etc/qemu/bridge.conf</span>
</pre></div>
</div>
</div>
<p>启动qemu2</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">qemu-system-aarch64 -M virt-4.0 -m 1G -cpu cortex-a57 -nographic -kernel zImage -initrd openeuler-image-qemu-aarch64-20220331025547.rootfs.cpio.gz  -device virtio-net-device,netdev=tap1,mac=52:54:00:12:34:78 -netdev bridge,id=tap1</span>
</pre></div>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>qemu1与qemu2的mac地址需要配置为不同的值</p>
</div>
<p>配置IP</p>
<p>配置host的网桥地址</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ifconfig br0 192.168.10.1 up</span>
</pre></div>
</div>
<p>配置qemu1的网络地址</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ifconfig eth0 192.168.10.2</span>
</pre></div>
</div>
<p>配置qemu2的网络地址</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ifconfig eth0 192.168.10.3</span>
</pre></div>
</div>
<p>分别在host、qemu1、qemu2使用ping进行测试，确保qemu1可以ping通qemu2。</p>
</div></blockquote>
</li>
<li><p>启动分布式软总线</p>
<p>在qemu1和qemu2中启动分布式软总线的服务端</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">softbus_server_main &gt;log.file &amp;</span>
</pre></div>
</div>
<p>将编译好的客户端分发到qemu1和qemu2的根目录中</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">scp softbus_client_main root@192.168.10.2:/</span>
<span class="go">scp softbus_client_main root@192.168.10.3:/</span>
</pre></div>
</div>
<p>分别在qemu1和qemu2的根目录下运行softbus_client_main，双方均会发现对端设备并输出设备信息：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&lt;DeviceFound&gt;CB: Device has found</span>
<span class="go">devId=6B86B273FF34FCE19D6B804EFF5A3F5747ADA4EAA22F1D49C01E52DDB7875B4B</span>
<span class="go">devName=openEuler</span>
<span class="go">devType=175</span>
<span class="go">addrNum=1</span>
<span class="go">        addr1:type=3,ip=192.168.10.3,port=44749,peerUid=</span>
<span class="go">capabilityBitmapNum=1</span>
<span class="go">        capabilityBitmap[1]=0xc0</span>
<span class="go">custData=</span>
</pre></div>
</div>
<p>将一端作为发送方，输出字符’c’后，会显示在同一个本地神经网络中的其他设备信息</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Input c to commnuication, Input s to stop:c</span>
<span class="go">&lt;GetAllNodeDeviceInfo&gt;return 1 Node</span>
<span class="go">&lt;num 1&gt;deviceName=openEuler</span>
<span class="go">        networkId=15a5e255f24073630c04a52f83679677b817df008fc11a22711cb3038de9d9b1</span>
<span class="go">        Type=0</span>
</pre></div>
</div>
<p>继续输入节点序号后，将尝试创建与对应节点的连接并传输测试数据</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Input Node num to commnunication:1</span>
</pre></div>
</div>
<p>若传输成功，则在对端设备上会显示传输数据的结果</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&lt;ByteRecived&gt;CB: session 2 received 17 bytes data=hello world test</span>
</pre></div>
</div>
<p>测试结束后，输入字符’s’退出双端程序</p>
</div></blockquote>
</li>
</ol>
</section>
<section id="id4">
<h2>可信设备添加<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p><strong>背景</strong></p>
<p>软总线在创建连接的过程中，会调用hichain模块的认证接口，与对端的设备进行认证操作。hichain模块为OpenHarmony提供设备认证能力，支持通过点对点认证方式创建可信群组。</p>
<p>若仅为openEuler之间的软总线连接，可以通过绕过hichain认证或者自定义认证实现。但如果openEuler和OpenHarmony设备之间要互连互通，则需要在openEuler上支持hichain的点对点认证和可信群组创建能力。</p>
<p><strong>应用说明</strong></p>
<p>hichain模块与软总线一样，分为服务端和客户端:</p>
<ul class="simple">
<li><p><strong>服务端</strong>:在openEuler上，实现了hichain和softbus的服务端共进程，即用户仅需拉起softbus服务端，无需额外操作hichain服务端。</p></li>
<li><p><strong>客户端</strong>:通过hichain的客户端提供的API，可以创建群组，并请求添加群组成员，从而将多个设备添加到可信群组。</p></li>
</ul>
<p>hichain的客户端为动态链接库，用户可以单独链接hichain的客户端进行可信群组创建。在可信群组创建后，软总线会自动触发组网，支持后续软总线客户端的连接和传输。</p>
<p><strong>客户端API</strong></p>
<p>hichain的客户端API头文件在嵌入式版本提供的sdk中对外开放，可在客户端代码中引用。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span>include <span class="s2">&quot;device_auth.h&quot;</span>
</pre></div>
</div>
<p>1.直接调用接口</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 29%" />
<col style="width: 71%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>InitDeviceAuthService</p></td>
<td><p>初始化hichain客户端</p></td>
</tr>
<tr class="row-even"><td><p>GetGmInstance</p></td>
<td><p>获取客户端群组管理的操作函数组</p></td>
</tr>
<tr class="row-odd"><td><p>DestroyDeviceAuthService</p></td>
<td><p>注销hichain客户端</p></td>
</tr>
</tbody>
</table>
<p>2.GetGmInstance返回的操作函数组</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 29%" />
<col style="width: 71%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>regCallback</p></td>
<td><p>注册群组创建和请求回调函数</p></td>
</tr>
<tr class="row-even"><td><p>unRegCallback</p></td>
<td><p>解注册群组回调函</p></td>
</tr>
<tr class="row-odd"><td><p>createGroup</p></td>
<td><p>创建新的群组</p></td>
</tr>
<tr class="row-even"><td><p>getGroupInfo</p></td>
<td><p>查询本地群组信息</p></td>
</tr>
<tr class="row-odd"><td><p>destroyInfo</p></td>
<td><p>释放通过getGroupInfo申请的内存</p></td>
</tr>
<tr class="row-even"><td><p>addMemberToGroup</p></td>
<td><p>请求添加成员到群组</p></td>
</tr>
<tr class="row-odd"><td><p>isDeviceInGroup</p></td>
<td><p>查询某个设备是否在群组中</p></td>
</tr>
</tbody>
</table>
<p>更详细的接口说明，请参考社区hichain模块代码实现。</p>
<p><strong>客户端编译</strong></p>
<p>客户端提供动态链接库：libdeviceauth_sdk.z.so</p>
<p>用户使用hichain创建群组和添加可信设备时，需要作为客户端程序显式链接该动态库，即可通过函数调用使用hichain提供的API。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span>: <span class="si">${</span><span class="nv">CROSS_COMPILE</span><span class="si">}</span>ld -ldeviceauth_sdk.z
</pre></div>
</div>
<p><strong>使用范例</strong></p>
<p>1.按照hichain的点对点pin码认证方式，需要通过设备创建群组（host），另一个台设备请求添加成员到该群组（target），实例代码如下：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span>include &lt;stdio.h&gt;
<span class="gp">#</span>include &lt;cJSON.h&gt;
<span class="gp">#</span>include &lt;securec.h&gt;
<span class="gp">#</span>include &lt;softbus_common.h&gt;
<span class="gp">#</span>include &lt;device_auth.h&gt;
<span class="gp">#</span>include &lt;parameter.h&gt;

<span class="gp">#</span>define APP_ID <span class="s2">&quot;hichain_test&quot;</span>
<span class="gp">#</span>define DEFAULT_GROUP_NAME <span class="s2">&quot;dsoftbus&quot;</span>
<span class="gp">#</span>define DEFAULT_PIN_CODE <span class="s2">&quot;123456&quot;</span>
<span class="gp">#</span>define MAX_UDID_LEN <span class="m">65</span>
<span class="gp">#</span>define MAX_GROUP_LEN <span class="m">65</span>

<span class="gp">#</span>define FIELD_ETH_IP <span class="s2">&quot;ETH_IP&quot;</span>
<span class="gp">#</span>define FIELD_ETH_PORT <span class="s2">&quot;ETH_PORT&quot;</span>
<span class="gp">#</span>define FIELD_WLAN_IP <span class="s2">&quot;WIFI_IP&quot;</span>
<span class="gp">#</span>define FIELD_WLAN_PORT <span class="s2">&quot;WIFI_PORT&quot;</span>

<span class="go">static const DeviceGroupManager *g_hichainGmInstance = NULL;</span>
<span class="go">static char g_udid[MAX_UDID_LEN];</span>
<span class="go">static char g_groupId[MAX_GROUP_LEN];</span>
<span class="go">static int64_t g_requestId = 1;</span>

<span class="go">static const char *GetStringFromJson(const cJSON *obj, const char *key)</span>
<span class="go">{</span>
<span class="go">    cJSON *item;</span>

<span class="go">    if (obj == NULL || key == NULL)</span>
<span class="go">            return NULL;</span>

<span class="go">    item = cJSON_GetObjectItemCaseSensitive(obj, key);</span>
<span class="go">    if (item != NULL &amp;&amp; cJSON_IsString(item)) {</span>
<span class="go">            return cJSON_GetStringValue(item);</span>
<span class="go">    } else {</span>
<span class="go">            int len = cJSON_GetArraySize(obj);</span>
<span class="go">            for (int i = 0; i &lt; len; i++) {</span>
<span class="go">                    item = cJSON_GetArrayItem(obj, i);</span>
<span class="go">                    if (cJSON_IsObject(item)) {</span>
<span class="go">                            const char *value = GetStringFromJson(item, key);</span>
<span class="go">                            if (value != NULL)</span>
<span class="go">                                    return value;</span>
<span class="go">                    }</span>
<span class="go">            }</span>
<span class="go">    }</span>
<span class="go">    return NULL;</span>
<span class="go">}</span>

<span class="go">static int HichainSaveGroupID(const char *param)</span>
<span class="go">{</span>
<span class="go">    cJSON *msg = cJSON_Parse(param);</span>
<span class="go">    const char *value = NULL;</span>

<span class="go">    if (msg == NULL) {</span>
<span class="go">            printf(&quot;HichainSaveGroupID: cJSON_Parse fail\n&quot;);</span>
<span class="go">            return -1;</span>
<span class="go">    }</span>

<span class="go">    value = GetStringFromJson(msg, FIELD_GROUP_ID);</span>
<span class="go">    if (value == NULL) {</span>
<span class="go">            printf(&quot;HichainSaveGroupID:GetStringFromJson fail\n&quot;);</span>
<span class="go">            cJSON_Delete(msg);</span>
<span class="go">            return -1;</span>
<span class="go">    }</span>

<span class="go">    memcpy_s(g_groupId, MAX_GROUP_LEN, value, strlen(value));</span>
<span class="go">    printf(&quot;HichainSaveGroupID:groupID=%s\n&quot;, g_groupId);</span>

<span class="go">    cJSON_Delete(msg);</span>
<span class="go">    return 0;</span>
<span class="go">}</span>

<span class="go">static void HiChainGmOnFinish(int64_t requestId, int operationCode, const char *returnData)</span>
<span class="go">{</span>
<span class="go">    if (operationCode == GROUP_CREATE &amp;&amp; returnData != NULL) {</span>
<span class="go">            printf(&quot;create new group finish:requestId=%lld, returnData=%s\n&quot;, requestId, returnData);</span>
<span class="go">            HichainSaveGroupID(returnData);</span>
<span class="go">    } else if (operationCode == MEMBER_JOIN) {</span>
<span class="go">            printf(&quot;member join finish:requestId=%lld, returnData=%s\n&quot;, requestId, returnData);</span>

<span class="go">    } else {</span>
<span class="go">            printf(&quot;&lt;HiChainGmOnFinish&gt;CB:requestId=%lld, operationCode=%d, returnData=%s\n&quot;, requestId, operationCode, returnData);</span>
<span class="go">    }</span>
<span class="go">}</span>

<span class="go">static void HiChainGmOnError(int64_t requestId, int operationCode, int errorCode, const char *errorReturn)</span>
<span class="go">{</span>
<span class="go">    printf(&quot;&lt;HiChainGmOnError&gt;CB:requestId=%lld, operationCode=%d, errorCode=%d, errorReturn=%s\n&quot;, requestId, operationCode, errorCode, errorReturn);</span>
<span class="go">}</span>

<span class="go">static char *HiChainGmOnRuest(int64_t requestId, int operationCode, const char *reqParams)</span>
<span class="go">{</span>
<span class="go">    cJSON *msg = cJSON_CreateObject();</span>
<span class="go">    char *param = NULL;</span>

<span class="go">    printf(&quot;&lt;HiChainGmOnRuest&gt;CB:requestId=%lld, operationCode=%d, reqParams=%s&quot;, requestId, operationCode, reqParams);</span>

<span class="go">    if (operationCode != MEMBER_JOIN) {</span>
<span class="go">            return NULL;</span>
<span class="go">    }</span>

<span class="go">    if (msg == NULL) {</span>
<span class="go">            printf(&quot;HiChainGmOnRuest: cJSON_CreateObject fail\n&quot;);</span>
<span class="go">    }</span>

<span class="go">    if (cJSON_AddNumberToObject(msg, FIELD_CONFIRMATION, REQUEST_ACCEPTED) == NULL ||</span>
<span class="go">            cJSON_AddStringToObject(msg, FIELD_PIN_CODE, DEFAULT_PIN_CODE) == NULL ||</span>
<span class="go">            cJSON_AddStringToObject(msg, FIELD_DEVICE_ID, g_udid) == NULL) {</span>
<span class="go">            printf(&quot;HiChainGmOnRuest: cJSON_AddToObject fail\n&quot;);</span>
<span class="go">            cJSON_Delete(msg);</span>
<span class="go">            return NULL;</span>
<span class="go">    }</span>

<span class="go">    param = cJSON_PrintUnformatted(msg);</span>
<span class="go">    cJSON_Delete(msg);</span>
<span class="go">    return param;</span>
<span class="go">}</span>

<span class="go">static const DeviceAuthCallback g_groupManagerCallback = {</span>
<span class="go">    .onRequest = HiChainGmOnRuest,</span>
<span class="go">    .onError = HiChainGmOnError,</span>
<span class="go">    .onFinish = HiChainGmOnFinish,</span>
<span class="go">};</span>

<span class="go">int HichainGmRegCallback(void)</span>
<span class="go">{</span>
<span class="go">    return g_hichainGmInstance-&gt;regCallback(APP_ID, &amp;g_groupManagerCallback);</span>
<span class="go">}</span>

<span class="go">void HichainGmUnRegCallback(void)</span>
<span class="go">{</span>
<span class="go">    g_hichainGmInstance-&gt;unRegCallback(APP_ID);</span>
<span class="go">}</span>

<span class="go">int HichainGmGetGroupInfo(char **groupVec, uint32_t *num)</span>
<span class="go">{</span>
<span class="go">    cJSON *msg = cJSON_CreateObject();</span>
<span class="go">    char *param = NULL;</span>
<span class="go">    int ret = -1;</span>

<span class="go">    if (msg == NULL) {</span>
<span class="go">            printf(&quot;HichainGmGetGroupInfo: cJSON_CreateObject fail\n&quot;);</span>
<span class="go">            return -1;</span>
<span class="go">    }</span>

<span class="go">    if (cJSON_AddNumberToObject(msg, FIELD_GROUP_TYPE, PEER_TO_PEER_GROUP) == NULL ||</span>
<span class="go">            cJSON_AddStringToObject(msg, FIELD_GROUP_NAME, DEFAULT_GROUP_NAME) == NULL ||</span>
<span class="go">            cJSON_AddNumberToObject(msg, FIELD_GROUP_VISIBILITY, GROUP_VISIBILITY_PUBLIC) == NULL) {</span>
<span class="go">            printf(&quot;HichainGmGetGroupInfo: cJSON_AddToObject fail\n&quot;);</span>
<span class="go">            goto err_cJSON_Delete;</span>
<span class="go">    }</span>
<span class="go">    param = cJSON_PrintUnformatted(msg);</span>
<span class="go">    if (param == NULL) {</span>
<span class="go">            printf(&quot;HichainGmGetGroupInfo: cJSON_PrintUnformatted fail\n&quot;);</span>
<span class="go">            goto err_cJSON_Delete;</span>
<span class="go">    }</span>

<span class="go">    ret = g_hichainGmInstance-&gt;getGroupInfo(ANY_OS_ACCOUNT, APP_ID, param, groupVec, num);</span>
<span class="go">    if (ret != 0) {</span>
<span class="go">            printf(&quot;getGroupInfo fail:%d&quot;, ret);</span>
<span class="go">            goto err_getGroupInfo;</span>
<span class="go">    }</span>

<span class="go">err_getGroupInfo:</span>
<span class="go">    cJSON_free(param);</span>
<span class="go">err_cJSON_Delete:</span>
<span class="go">    cJSON_Delete(msg);</span>
<span class="go">    return ret;</span>
<span class="go">}</span>

<span class="go">void HichainGmDestroyGroupInfo(char **groupVec)</span>
<span class="go">{</span>
<span class="go">    g_hichainGmInstance-&gt;destroyInfo(groupVec);</span>
<span class="go">}</span>

<span class="go">int HichainGmCreatGroup(void)</span>
<span class="go">{</span>
<span class="go">    cJSON *msg = cJSON_CreateObject();</span>
<span class="go">    char *param = NULL;</span>
<span class="go">    int ret;</span>

<span class="go">    if (msg == NULL)</span>
<span class="go">            return -1;</span>

<span class="go">    if (cJSON_AddNumberToObject(msg, FIELD_GROUP_TYPE, PEER_TO_PEER_GROUP) == NULL ||</span>
<span class="go">            cJSON_AddStringToObject(msg, FIELD_DEVICE_ID, g_udid) == NULL ||</span>
<span class="go">            cJSON_AddStringToObject(msg, FIELD_GROUP_NAME, DEFAULT_GROUP_NAME) == NULL ||</span>
<span class="go">            cJSON_AddNumberToObject(msg, FIELD_USER_TYPE, 0) == NULL ||</span>
<span class="go">            cJSON_AddNumberToObject(msg, FIELD_GROUP_VISIBILITY, GROUP_VISIBILITY_PUBLIC) == NULL ||</span>
<span class="go">            cJSON_AddNumberToObject(msg, FIELD_EXPIRE_TIME, EXPIRE_TIME_MAX) == NULL) {</span>
<span class="go">            printf(&quot;HichainGmCreatGroup: cJSON_AddToObject fail\n&quot;);</span>
<span class="go">            cJSON_Delete(msg);</span>
<span class="go">            return -1;</span>
<span class="go">    }</span>
<span class="go">    param = cJSON_PrintUnformatted(msg);</span>
<span class="go">    if (param == NULL) {</span>
<span class="go">            printf(&quot;HichainGmCreatGroup: cJSON_PrintUnformatted fail\n&quot;);</span>
<span class="go">            cJSON_Delete(msg);</span>
<span class="go">            return -1;</span>
<span class="go">    }</span>

<span class="go">    ret = g_hichainGmInstance-&gt;createGroup(ANY_OS_ACCOUNT, g_requestId++, APP_ID, param);</span>

<span class="go">    cJSON_free(param);</span>
<span class="go">    cJSON_Delete(msg);</span>
<span class="go">    return ret;</span>
<span class="go">}</span>

<span class="go">bool HichainIsDeviceInGroup(const char *groupId, const char *devId)</span>
<span class="go">{</span>
<span class="go">    return g_hichainGmInstance-&gt;isDeviceInGroup(ANY_OS_ACCOUNT, APP_ID, groupId, devId);</span>
<span class="go">}</span>

<span class="go">int HichainGmAddMemberToGroup(const DeviceInfo *device, const char *groupId)</span>
<span class="go">{</span>
<span class="go">    cJSON *msg = cJSON_CreateObject();</span>
<span class="go">    cJSON *addr = NULL;</span>
<span class="go">    char *param = NULL;</span>
<span class="go">    int ret = -1;</span>

<span class="go">    if (msg == NULL) {</span>
<span class="go">            printf(&quot;HichainGmAddMemberToGroup: cJSON_CreateObject1 fail\n&quot;);</span>
<span class="go">            return -1;</span>
<span class="go">    }</span>

<span class="go">    addr = cJSON_CreateObject();</span>
<span class="go">    if (addr == NULL) {</span>
<span class="go">            printf(&quot;HichainGmAddMemberToGroup: cJSON_CreateObject2 fail\n&quot;);</span>
<span class="go">            goto err_cJSON_CreateObject;</span>
<span class="go">    }</span>

<span class="go">    for (unsigned int i = 0; i &lt; device-&gt;addrNum; i++) {</span>
<span class="go">            if (device-&gt;addr[i].type == CONNECTION_ADDR_ETH) {</span>
<span class="go">                    if (cJSON_AddStringToObject(addr, FIELD_ETH_IP, device-&gt;addr[i].info.ip.ip) == NULL ||</span>
<span class="go">                                    cJSON_AddNumberToObject(addr, FIELD_ETH_PORT, device-&gt;addr[i].info.ip.port) == NULL) {</span>
<span class="go">                            printf(&quot;HichainGmAddMemberToGroup: cJSON_AddToObject1 fail\n&quot;);</span>
<span class="go">                            goto err_cJSON_AddToObject;</span>
<span class="go">                    }</span>
<span class="go">            } else if (device-&gt;addr[i].type == CONNECTION_ADDR_WLAN) {</span>
<span class="go">                    if (cJSON_AddStringToObject(addr, FIELD_WLAN_IP, device-&gt;addr[i].info.ip.ip) == NULL ||</span>
<span class="go">                                    cJSON_AddNumberToObject(addr, FIELD_WLAN_PORT, device-&gt;addr[i].info.ip.port) == NULL) {</span>
<span class="go">                            printf(&quot;HichainGmAddMemberToGroup: cJSON_AddToObject2 fail\n&quot;);</span>
<span class="go">                            goto err_cJSON_AddToObject;</span>
<span class="go">                    }</span>
<span class="go">            } else {</span>
<span class="go">                    printf(&quot;unsupport connection type:%d\n&quot;, device-&gt;addr[i].type);</span>
<span class="go">                    goto err_cJSON_AddToObject;</span>
<span class="go">            }</span>
<span class="go">    }</span>

<span class="go">    param = cJSON_PrintUnformatted(addr);</span>
<span class="go">    if (param == NULL) {</span>
<span class="go">            printf(&quot;HichainGmAddMemberToGroup: cJSON_PrintUnformatted1 fail\n&quot;);</span>
<span class="go">            goto err_cJSON_AddToObject;</span>
<span class="go">    }</span>

<span class="go">    if (cJSON_AddStringToObject(msg, FIELD_GROUP_ID, groupId) == NULL ||</span>
<span class="go">            cJSON_AddNumberToObject(msg, FIELD_GROUP_TYPE, PEER_TO_PEER_GROUP) == NULL ||</span>
<span class="go">            cJSON_AddStringToObject(msg, FIELD_PIN_CODE, DEFAULT_PIN_CODE) == NULL ||</span>
<span class="go">            cJSON_AddStringToObject(msg, FIELD_DEVICE_ID, g_udid) == NULL ||</span>
<span class="go">            cJSON_AddStringToObject(msg, FIELD_GROUP_NAME, DEFAULT_GROUP_NAME) == NULL ||</span>
<span class="go">            cJSON_AddBoolToObject(msg, FIELD_IS_ADMIN, false) == NULL ||</span>
<span class="go">            cJSON_AddStringToObject(msg, FIELD_CONNECT_PARAMS, param) == NULL) {</span>
<span class="go">            printf(&quot;HichainGmAddMemberToGroup: cJSON_AddToObject4 fail\n&quot;);</span>
<span class="go">            goto err_cJSON_AddToObject1;</span>
<span class="go">    }</span>

<span class="go">    cJSON_free(param);</span>
<span class="go">    param = cJSON_PrintUnformatted(msg);</span>
<span class="go">    if (param == NULL) {</span>
<span class="go">            printf(&quot;HichainGmAddMemberToGroup: cJSON_PrintUnformatted fail\n&quot;);</span>
<span class="go">            goto err_cJSON_CreateObject;</span>
<span class="go">    }</span>

<span class="go">    ret = g_hichainGmInstance-&gt;addMemberToGroup(ANY_OS_ACCOUNT, g_requestId++, APP_ID, param);</span>
<span class="go">    if (ret != 0) {</span>
<span class="go">            printf(&quot;addMemberToGroup fail:%d\n&quot;, ret);</span>
<span class="go">    }</span>

<span class="go">err_cJSON_AddToObject1:</span>
<span class="go">    cJSON_free(param);</span>
<span class="go">err_cJSON_AddToObject:</span>
<span class="go">    cJSON_Delete(addr);</span>
<span class="go">err_cJSON_CreateObject:</span>
<span class="go">    cJSON_Delete(msg);</span>
<span class="go">    return ret;</span>
<span class="go">}</span>

<span class="go">int HichainInit(void)</span>
<span class="go">{</span>
<span class="go">    char *groupVec = NULL;</span>
<span class="go">    uint32_t num;</span>
<span class="go">    int ret;</span>

<span class="go">    ret = GetDevUdid(g_udid, MAX_UDID_LEN);</span>
<span class="go">    if (ret) {</span>
<span class="go">            printf(&quot;GetDevUdid fail:%d\n&quot;, ret);</span>
<span class="go">            return ret;</span>
<span class="go">    }</span>

<span class="go">    ret = InitDeviceAuthService();</span>
<span class="go">    if (ret != 0) {</span>
<span class="go">            printf(&quot;InitDeviceAuthService fail:%d\n&quot;, ret);</span>
<span class="go">            return ret;</span>
<span class="go">    }</span>

<span class="go">    g_hichainGmInstance = GetGmInstance();</span>
<span class="go">    if (g_hichainGmInstance == NULL) {</span>
<span class="go">            printf(&quot;GetGmInstance fail\n&quot;);</span>
<span class="go">            ret = -1;</span>
<span class="go">            goto err_GetGmInstance;</span>
<span class="go">    }</span>

<span class="go">    ret = HichainGmRegCallback();</span>
<span class="go">    if (ret != 0) {</span>
<span class="go">            printf(&quot;HichainGmregCallback fail.:%d\n&quot;, ret);</span>
<span class="go">            goto err_HichainGmRegCallback;</span>
<span class="go">    }</span>

<span class="go">    ret = HichainGmGetGroupInfo(&amp;groupVec, &amp;num);</span>
<span class="go">    if (ret != 0) {</span>
<span class="go">            printf(&quot;HichainGmGetGroupInfo fail:%d\n&quot;, ret);</span>
<span class="go">            goto err_HichainGmGetGroupInfo;</span>
<span class="go">    }</span>

<span class="go">    if (num == 0) {</span>
<span class="go">            ret = HichainGmCreatGroup();</span>
<span class="go">            if (ret) {</span>
<span class="go">                    printf(&quot;HichainGmCreatGroup fail:%d\n&quot;, ret);</span>
<span class="go">                    goto err_HichainGmCreatGroup;</span>
<span class="go">            }</span>
<span class="go">    } else {</span>
<span class="go">            printf(&quot;HichainGmGetGroupInfo:num=%u\n&quot;, num);</span>
<span class="go">            HichainSaveGroupID(groupVec);</span>
<span class="go">            HichainGmDestroyGroupInfo(&amp;groupVec);</span>
<span class="go">    }</span>

<span class="go">    return 0;</span>

<span class="go">err_HichainGmCreatGroup:</span>
<span class="go">err_HichainGmGetGroupInfo:</span>
<span class="go">    HichainGmUnRegCallback();</span>
<span class="go">err_HichainGmRegCallback:</span>
<span class="go">err_GetGmInstance:</span>
<span class="go">    DestroyDeviceAuthService();</span>
<span class="go">    return ret;</span>
<span class="go">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>在HichainInit完成后，可以在任意一端调用HichainGmAddMemberToGroup申请将本端设备添加到对端的群组中。</p></li>
<li><p>认证中使用的pin码，分别在两端设备中通过addMemberToGroup函数和HiChainGmOnRuest回调函数接口传入，实际应用中可由用户随机生成。</p></li>
<li><p>HichainGmAddMemberToGroup认证过程中需要交互的对端信息，如deviceInfo，groupID等，实际应用中可通过软总线的发现能力和认证通道进行数据交互。</p></li>
</ul>
</div>
<p>2.与OpenHarmony互联时，可通过上述方式创建双方信任的可信群组和成员，也可使用分布式硬件中的device manger模块进行更便捷的可信群组创建，该模块兼容OpenHarmony的pin码弹窗等功能，但需要openEuler额外支持。</p>
</section>
<section id="id5">
<h2>全量编译指导<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>当用户有需求自定义修改软总线功能模块时，可使用全量编译方式构建软总线的各个子模块。</p>
<p>嵌入式版本提供的dsoftbus代码已集成于yocto构建系统，作为一个package存在，编译依托于embedded版本发布的容器镜像进行，搭建容器构建环境请参考 <a class="reference internal" href="../yocto/quickbuild/container-build.html#container-build"><span class="std std-ref">容器环境下的快速构建指导</span></a> 章节。</p>
<p>用户也可按照镜像编译指导完成环境准备后按如下命令单独进行编译（和单独编译package方法一致）</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">bitbake dsoftbus</span>
</pre></div>
</div>
<p>编译过程和结果遵循yocto构建策略，日志和生成物参考yocto bb文件和默认工作目录。</p>
</section>
<section id="id6">
<h2>限制约束<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<p>1.支持wifi和有限的标准以太局域网下的coap设备发现和传输。ble等南向协议拓展功能在后续版本中持续支持。</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="mcs.html" class="btn btn-neutral float-left" title="多OS混合部署框架" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="raspberrypi.html" class="btn btn-neutral float-right" title="树莓派4B的支持" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, openEuler Embedded.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: openEuler-22.03-LTS-SP1
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Branches</dt>
      <dd><a href="../../master/features/distributed_softbus.html">master</a></dd>
      <dd><a href="../../openEuler-21.09/index.html">openEuler-21.09</a></dd>
      <dd><a href="../../openEuler-22.03-LTS/index.html">openEuler-22.03-LTS</a></dd>
      <dd><a href="distributed_softbus.html">openEuler-22.03-LTS-SP1</a></dd>
      <dd><a href="../../openEuler-22.03-LTS-SP2/features/distributed_softbus.html">openEuler-22.03-LTS-SP2</a></dd>
      <dd><a href="../../openEuler-22.03-LTS-SP3/features/distributed_softbus.html">openEuler-22.03-LTS-SP3</a></dd>
      <dd><a href="../../openEuler-22.09/features/distributed_softbus.html">openEuler-22.09</a></dd>
      <dd><a href="../../openEuler-23.03/features/distributed_softbus.html">openEuler-23.03</a></dd>
      <dd><a href="../../openEuler-23.09/features/distributed_softbus.html">openEuler-23.09</a></dd>
    </dl>
  </div>
</div>
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>