<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QEMU控制台 &mdash; openEuler Embedded在线文档 24.03 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="代码提交指导" href="../../commit.html" />
    <link rel="prev" title="QEMU调试" href="qemu_debug.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> openEuler Embedded在线文档
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">介绍与概述</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/index.html">总体介绍</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/index.html">快速上手</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../releases/index.html">版本说明</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../test_data/index.html">测试数据</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">指导手册</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../user_guide/index.html">用户使用指导</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">开发及贡献指导</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../code_download_compile.html">下载编译指导</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../develop/index.html">代码开发指导</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">功能调试指导</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../gdb_guide/index.html">基于GDB Server的调试指南</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">QEMU仿真器的使用</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="qemu_start.html">QEMU使用</a></li>
<li class="toctree-l4"><a class="reference internal" href="qemu_debug.html">QEMU调试</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">QEMU控制台</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#info">1、Info</a></li>
<li class="toctree-l5"><a class="reference internal" href="#x-xp">2、x/xp命令</a></li>
<li class="toctree-l5"><a class="reference internal" href="#savevm-loadvm">3、savevm/loadvm命令</a></li>
<li class="toctree-l5"><a class="reference internal" href="#gva2gpa-gpa2hpa-gpa2hva">4、gva2gpa/gpa2hpa/gpa2hva</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../commit.html">代码提交指导</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contribute_doc.html">文档提交指导</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/index.html">常见问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../references/index.html">参考文档</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">openEuler Embedded在线文档</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">开发及贡献指导</a> &raquo;</li>
          <li><a href="../index.html">功能调试指导</a> &raquo;</li>
          <li><a href="index.html">QEMU仿真器的使用</a> &raquo;</li>
      <li>QEMU控制台</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="qemu">
<span id="qemu-monitor"></span><h1>QEMU控制台<a class="headerlink" href="#qemu" title="Permalink to this headline">¶</a></h1>
<p>QEMU控制台，即QEMU monitor，是在QEMU模拟器运行时为其提供各种有用功能模块的工具，可以在比如调试时得到意想不到的帮助。在QEMU模拟器启动后，通过ctrl +a + c的操作序列进入。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(qemu)</span>
</pre></div>
</div>
<p>在操作后即为如图所示的样子，会显示(QEMU)的字样。在这个时候，有各种命令可以使用。使用help命令，即可以看到所有支持的命令(下面的图只是示例，并不包含全部内容)</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">acl_add aclname match allow|deny [index] -- add a match rule to the access control list</span>
<span class="go">acl_policy aclname allow|deny -- set default access control list policy</span>
<span class="go">acl:remove aclname match -- remove a match rule from the access control list</span>
<span class="go">acl_reset aclname -- reset the access control list</span>
<span class="go">acl_show aclname -- list rules in the access control list</span>
<span class="go">announce_self [interfaces] [id] -- Trigger GARP/RARP announcements</span>
<span class="go">balloon target -- request VM to change its memory allocation (in MB)</span>
<span class="go">block_job_cancel [-f] device -- stop an active background block operation (use -f</span>
<span class="go">         if you want to abort the operation immediately</span>
<span class="go">         instead of keep running until data is in sync)</span>
<span class="go">block_job_complete device -- stop an active background block operation</span>
<span class="go">block_job_pause device -- pause an active background block operation</span>
<span class="go">block_job_resume device -- resume a paused background block operation</span>
<span class="go">block_job_set_speed device speed -- set maximum speed for a background block operation</span>
<span class="go">block_passwd block_passwd device password -- set the password of encrypted block devices</span>
<span class="go">block_resize device size -- resize a block image</span>
<span class="go">block_set_io_throttle device bps bps_rd bps_wr iops iops_rd iops_wr -- change I/O throttle limits for a block drive</span>
<span class="go">block_stream device [speed [base]] -- copy data from a backing file into a block device</span>
<span class="go">boot_set bootdevice -- define new values for the boot device list</span>
<span class="go">change device filename [format [read-only-mode]] -- change a removable medium, optional format</span>
<span class="go">chardev-add args -- add chardev</span>
<span class="go">chardev-change id args -- change chardev</span>
<span class="go">chardev-remove id -- remove chardev</span>
<span class="go">chardev-send-break id -- send a break on chardev</span>
<span class="go">client_migrate_info protocol hostname port tls-port cert-subject -- set migration information for remote display</span>
<span class="go">closefd closefd name -- close a file descriptor previously passed via SCM rights</span>
<span class="go">commit device|all -- commit changes to the disk images (if -snapshot is used) or backing files</span>
<span class="go">cpu index -- set the default CPU</span>
<span class="go">cpu-add id -- add cpu (deprecated, use device_add instead)</span>
<span class="go">c|cont  -- resume emulation</span>
<span class="go">delvm tag -- delete a VM snapshot from its tag</span>
<span class="go">device_add driver[,prop=value][,...] -- add device, like -device on the command line</span>
<span class="go">device_del device -- remove device</span>
<span class="go">drive_add [-n] [[&lt;domain&gt;:]&lt;bus&gt;:]&lt;slot&gt;</span>
<span class="go">[file=file][,if=type][,bus=n]</span>
<span class="go">[,unit=m][,media=d][,index=i]</span>
<span class="go">[,snapshot=on|off][,cache=on|off]</span>
<span class="go">[,readonly=on|off][,copy-on-read=on|off] -- add drive to PCI storage controller</span>
<span class="go">drive_backup [-n] [-f] [-c] device target [format] -- initiates a point-in-time</span>
<span class="go">         copy for a device. The device&#39;s contents are</span>
<span class="go">         copied to the new image file, excluding data that</span>
<span class="go">         is written after the command is started.</span>
<span class="go">         The -n flag requests QEMU to reuse the image found</span>
<span class="go">         in new-image-file, instead of recreating it from scratch.</span>
<span class="go">         The -f flag requests QEMU to copy the whole disk,</span>
<span class="go">         so that the result does not need a backing file.</span>
<span class="go">         The -c flag requests QEMU to compress backup data</span>
<span class="go">         (if the target format supports it).</span>

<span class="go">drive_del device -- remove host block device</span>
<span class="go">...</span>
</pre></div>
</div>
<p>使用help [命令]的方式，可以看到某个具体命令的使用说明。</p>
<p>本篇文章会介绍几个调试过程中相对较为常用的控制台命令，希望对开发、定位问题能有所帮助。</p>
<section id="info">
<h2>1、Info<a class="headerlink" href="#info" title="Permalink to this headline">¶</a></h2>
<p>Info顾名思义，是查看这个启动的虚拟机相关的各项信息的一个命令。它本身又是一套命令的合集，可以查看虚拟机相关的很多方面。使用help info，可以看到如下图所示的所有可用的info命令(下面的图只是示例，并不包含info的全部内容)。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">info migrate  -- show migration status</span>
<span class="go">info migrate_cache_size  -- show current migration xbzrle cache size</span>
<span class="go">info migrate_capabilities  -- show current migration capabilities</span>
<span class="go">info migrate_parameters  -- show current migration parameters</span>
<span class="go">info mtree [-f][-d][-o] -- show memory tree (-f: dump flat view for address spaces;-d: dump dispatch tree, valid with -f only);-o: dump region owners/parents</span>
<span class="go">info name  -- show the current VM name</span>
<span class="go">info network  -- show the network state</span>
<span class="go">info numa  -- show NUMA information</span>
<span class="go">info opcount  -- show dynamic compiler opcode counters</span>
<span class="go">info pci  -- show PCI info</span>
<span class="go">info pic  -- show PIC state</span>
<span class="go">info profile  -- show profiling information</span>
<span class="go">info qdm  -- show qdev device model list</span>
<span class="go">info qom-tree [path] -- show QOM composition tree</span>
<span class="go">info qtree  -- show device tree</span>
<span class="go">info ramblock  -- Display system ramblock information</span>
<span class="go">info rdma  -- show RDMA state</span>
<span class="go">info registers [-a] -- show the cpu registers (-a: all - show register info for all cpus)</span>
<span class="go">info rocker name -- Show rocker switch</span>
<span class="go">info rocker-of-dpa-flows name [tbl_id] -- Show rocker OF-DPA flow tables</span>
<span class="go">info rocker-of-dpa-groups name [type] -- Show rocker OF-DPA groups</span>
<span class="go">info rocker-ports name -- Show rocker ports</span>
<span class="go">info roms  -- show roms</span>
<span class="go">info snapshots  -- show the currently saved VM snapshots</span>
<span class="go">info status  -- show the current VM status (running|paused)</span>
<span class="go">info sync-profile [-m] [-n] [max] -- show synchronization profiling info, up to max entries (default: 10), sorted by total wait time. (-m: sort by mean wait time; -n: do not coalesce objects with the same call site)</span>
<span class="go">info tpm  -- show the TPM device</span>
<span class="go">info trace-events [name] [vcpu] -- show available trace-events &amp; their state (name: event name pattern; vcpu: vCPU to query, default is any)</span>
<span class="go">info usb  -- show guest USB devices</span>
<span class="go">info usbhost  -- show host USB devices</span>
<span class="go">info usernet  -- show user network stack connection states</span>
<span class="go">info uuid  -- show the current VM UUID</span>
<span class="go">info version  -- show the version of QEMU</span>
<span class="go">info vm-generation-id  -- Show Virtual Machine Generation ID</span>
<span class="go">info vnc  -- show the vnc server status</span>
</pre></div>
</div>
<p>这里比较常用的，如</p>
<ul class="simple">
<li><p>（1）可以查看物理地址空间结构的info mtree。任何一次QEMU模拟器的system级运行都可以理解为QEMU构建了一块完整的虚拟单板，而通过info mtree，可以看到这块虚拟单板的物理地址空间布局。</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">0000000000000000-ffffffffffffffff (prio 0, i/o): system</span>
<span class="go">0000000000000000-0000000003ffffff (prio 0, romd): virt.flash0</span>
<span class="go">0000000004000000-0000000007ffffff (prio 0, romd): virt.flash1</span>
<span class="go">0000000008000000-0000000008000fff (prio 0, i/o): gic_dist</span>
<span class="go">0000000008010000-0000000008011fff (prio 0, i/o): gic_cpu</span>
<span class="go">0000000008020000-0000000008020fff (prio 0, i/o): gicv2m</span>
<span class="go">0000000009000000-0000000009000fff (prio 0, i/o): pl011</span>
<span class="go">0000000009010000-0000000009010fff (prio 0, i/o): pl031</span>
<span class="go">0000000009020000-0000000009020007 (prio 0, i/o): fwcfg.data</span>
<span class="go">0000000009020008-0000000009020009 (prio 0, i/o): fwcfg.ctl</span>
<span class="go">0000000009020010-0000000009020017 (prio 0, i/o): fwcfg.dma</span>
<span class="go">0000000009030000-0000000009030fff (prio 0, i/o): pl061</span>
<span class="go">000000000a000000-000000000a0001ff (prio 0, i/o): virtio-mmio</span>
<span class="go">000000000a000200-000000000a0003ff (prio 0, i/o): virtio-mmio</span>
<span class="go">000000000a000400-000000000a0005ff (prio 0, i/o): virtio-mmio</span>
<span class="go">000000000a000600-000000000a0007ff (prio 0, i/o): virtio-mmio</span>
<span class="go">000000000a000800-000000000a0009ff (prio 0, i/o): virtio-mmio</span>
<span class="go">000000000a000a00-000000000a000bff (prio 0, i/o): virtio-mmio</span>
</pre></div>
</div>
<ul class="simple">
<li><p>（2）可以查看物理地址空间所有外设相关信息的info qtree。比起info mtree重点放在地址空间布局上，info qtree更注重每个外设本身的一些信息，如有多少mmio空间、数据位宽、中断个数等</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">bus: main-system-bus</span>
<span class="go">type System</span>
<span class="go">dev: platform-bus-device, id &quot;platform-bus-device&quot;</span>
<span class="go">   gpio-out &quot;sysbus-irq&quot; 64</span>
<span class="go">   num_irqs = 64 (0x40)</span>
<span class="go">   mmio_size = 33554432 (0x2000000)</span>
<span class="go">   mmio ffffffffffffffff/0000000002000000</span>
<span class="go">dev: fw_cfg_mem, id &quot;&quot;</span>
<span class="go">   data_width = 8 (0x8)</span>
<span class="go">   dma_enabled = true</span>
<span class="go">   x-file-slots = 32 (0x20)</span>
<span class="go">   mmio 0000000009020008/0000000000000002</span>
<span class="go">   mmio 0000000009020000/0000000000000008</span>
<span class="go">   mmio 0000000009020010/0000000000000008</span>
<span class="go">dev: virtio-mmio, id &quot;&quot;</span>
<span class="go">   gpio-out &quot;sysbus-irq&quot; 1</span>
<span class="go">   format_transport_address = true</span>
<span class="go">   force-legacy = true</span>
<span class="go">   mmio 000000000a003e00/0000000000000200</span>
<span class="go">   bus: virtio-mmio-bus.31</span>
<span class="go">      type virtio-mmio-bus</span>
</pre></div>
</div>
<ul class="simple">
<li><p>（3）可以查看有多少个cpu的info cpus。前面有*标志的cpu表示当前的cpu。使用cpu [cpu号]的命令，可以切换到某个其他的cpu上面。当前cpu表示正在观察的cpu，如info registers操作（后面会讲），如果不使用info registers -a，默认只会打印当前cpu的寄存器信息。</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">* CPU #0: thread_id=3639</span>
<span class="go">  CPU #1: thread_id=3640</span>
<span class="go">  CPU #2: thread_id=3641</span>
<span class="go">  CPU #3: thread_id=3642</span>
</pre></div>
</div>
<ul class="simple">
<li><p>（4）可以查看每个模拟cpu的寄存器信息的info registers</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">PC=ffffffc0104d16c0 X00=0000000000000000 X01=ffffffc010730000</span>
<span class="go">X02=ffffffc01075e340 X03=0000000000048600 X04=ffffff8007f82508</span>
<span class="go">X05=0000000000000000 X06=ffffff8007f82370 X07=0000000000000004</span>
<span class="go">X08=ffffffc01075ed30 X09=ffffffc010753e20 X10=0000000000000990</span>
<span class="go">X11=0000000000000000 X12=0000000000000000 X13=0000000000000000</span>
<span class="go">X14=0000000000000000 X15=0000000000000000 X16=0000000000000000</span>
<span class="go">X17=0000000000000000 X18=0000000000000000 X19=ffffffc010730000</span>
<span class="go">X20=ffffffc010758000 X21=0000000000000000 X22=ffffffc010758740</span>
<span class="go">X23=0000000000000001 X24=ffffffc0107587c0 X25=ffffffc01073fe40</span>
<span class="go">X26=ffffffc010720004 X27=00000000400800f0 X28=00000000406e0018</span>
<span class="go">X29=ffffffc010753ea0 X30=ffffffc0104d16d8  SP=ffffffc010753ea0</span>
<span class="go">PSTATE=40000085 -Z-- EL1h     FPCR=00000000 FPSR=00000000</span>
<span class="go">Q00=0000000000000000:0000000000000000 Q01=00000073252f7325:0000000000732520</span>
<span class="go">Q02=20746e697270206f:742064656c696146 Q03=ffffff0000000000:ffffffffff000000</span>
<span class="go">Q04=0000000000000000:0000000000000000 Q05=4010040040000001:4010040140000400</span>
<span class="go">Q06=0000000000000000:0000000000000000 Q07=4010040140100401:4010040140100401</span>
<span class="go">Q08=0000000000000000:41cdcd6500000000 Q09=0000000000000000:0000000000000000</span>
<span class="go">Q10=0000000000000000:0000000000000000 Q11=0000000000000000:0000000000000000</span>
<span class="go">Q12=0000000000000000:0000000000000000 Q13=0000000000000000:0000000000000000</span>
<span class="go">Q14=0000000000000000:0000000000000000 Q15=0000000000000000:0000000000000000</span>
<span class="go">Q16=0000000054415544:0000000054415544 Q17=0000000000000000:00000000a8000000</span>
<span class="go">Q18=0000000000000000:0000000000000000 Q19=0000000000000000:0000000000000000</span>
<span class="go">Q20=0000000000000000:0000000000000000 Q21=0000000000000000:0000000000000000</span>
<span class="go">Q22=0000000000000000:0000000000000000 Q23=0000000000000000:0000000000000000</span>
<span class="go">Q24=0000000000000000:0000000000000000 Q25=0000000000000000:0000000000000000</span>
<span class="go">Q26=0000000000000000:0000000000000000 Q27=0000000000000000:0000000000000000</span>
<span class="go">Q28=0000000000000000:0000000000000000 Q29=0000000000000000:0000000000000000</span>
<span class="go">Q30=0000000000000000:0000000000000000 Q31=0000000000000000:0000000000000000</span>
</pre></div>
</div>
<p>Info还有许许多多功能，这里不再一一列举了，大家可以直接在QEMU monitor中使用help info查看全部命令。</p>
</section>
<section id="x-xp">
<h2>2、x/xp命令<a class="headerlink" href="#x-xp" title="Permalink to this headline">¶</a></h2>
<p>QEMU monitor控制台很多时候可用于调试，所以有时需要打印各种地址上的内容。x和xp的功能相辅相成，一个可以通过物理地址打印内容，一个可以通过虚拟地址打印内容。用法和gdb中的x命令是相同的，但是gdb并不能看到某个进程使用了哪些物理地址，所以没有能够打印物理地址中内容的xp功能。</p>
<p>x/xp命令结合前面可以切换cpu的命令，可以打印在任何虚拟核心角度的，任意的地址里面的内容。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(qemu)</span> <span class="go">x/32wx 0xffffffc0104d16c0</span>
<span class="go">ffffffc0104d16c0: 0xd50323bf 0xd65f03c0 0xd503233f 0xa9bf7bfd</span>
<span class="go">ffffffc0104d16d0: 0x910003fd 0x97fffff8 0xa8c17bfd 0xd50323bf</span>
<span class="go">ffffffc0104d16e0: 0xd65f03c0 0xd503233f 0xa9bf7bfd 0x910003fd</span>
<span class="go">ffffffc0104d16f0: 0x97fffff6 0xd2801c00 0xd50342ff 0xa8c17bfd</span>
<span class="go">ffffffc0104d1700: 0xd50323bf 0xd65f03c0 0xd5184600 0xd503233f</span>
<span class="go">ffffffc0104d1710: 0xa9bc7bfd 0xd5384101 0x910003fd 0xa90153f3</span>
<span class="go">ffffffc0104d1720: 0xaa0003f4 0xa9025bf5 0xa90363f7 0xb9401020</span>
<span class="go">ffffffc0104d1730: 0xf9401035 0x11000400 0xb9001020 0xf00012e2</span>
<span class="gp gp-VirtualEnv">(qemu)</span> <span class="go">xp/32wx 0x404d2780</span>
<span class="go">00000000404d2780: 0xd503233f 0xa9bd7bfd 0x910003fd 0xa90153f3</span>
<span class="go">00000000404d2790: 0x90001873 0xa9025bf5 0x913b2273 0x90000136</span>
<span class="go">00000000404d27a0: 0x90001875 0x911782d6 0x913a02b5 0xd2800014</span>
<span class="go">00000000404d27b0: 0x94000792 0xd1012260 0xf8747ac1 0xf900301f</span>
<span class="go">00000000404d27c0: 0x91000694 0xf9000275 0xf9001a61 0x29087e7f</span>
<span class="go">00000000404d27d0: 0xb9044a7f 0x940007ab 0x91160273 0xf100129f</span>
<span class="go">00000000404d27e0: 0x54fffea1 0xa94153f3 0xa9425bf5 0xa8c37bfd</span>
<span class="go">00000000404d27f0: 0xd50323bf 0xd65f03c0 0xd503233f 0xa9be7bfd</span>
</pre></div>
</div>
</section>
<section id="savevm-loadvm">
<h2>3、savevm/loadvm命令<a class="headerlink" href="#savevm-loadvm" title="Permalink to this headline">¶</a></h2>
<dl>
<dt>savevm和loadvm两个命令可以当QEMU模拟器运行到某个状态时，将当前的整个内存中的镜像的状态保存和恢复到一个磁盘文件中。类似于大部分现代操作系统自带的hibernate和恢复的功能。savevm是保存镜像到磁盘文件，loadvm是从磁盘文件中加载一个之前保存过得磁盘镜像恢复出来。savevm的用法如下：</dt><dd><ul class="simple">
<li><p>首先在QEMU运行之前，通过qemu-img 的create命令，创建一个磁盘文件，磁盘文件必须是qcow2格式而不能是raw格式，因为raw格式的镜像不支持savevm/loadvm功能。如下面的命令，即创建了一个2G大小的，格式为qcow2，名为imagedisk的磁盘文件。</p></li>
</ul>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">qemu-img create -f qcow2 imagedisk 2G</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>在QEMU启动参数中，加上-hda [磁盘文件名]，如-hda imagedisk。以此告知QEMU模拟器使用hda参数指明的磁盘文件来保存磁盘镜像。</p></li>
</ul>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./qemu-4.2.1/aarch64-softmmu/qemu-system-aarch64 \</span>
<span class="go">  -M virt-4.0 \</span>
<span class="go">  -cpu cortex-a57 \</span>
<span class="go">  -smp 4 \</span>
<span class="go">  -nographic \</span>
<span class="go">  -kernel $KERNEL \</span>
<span class="go">  -initrd $INITRD \</span>
<span class="go">  -hda imagedisk</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>这样一来，当QEMU运行的时候，就可以随时将当前状态通过savevm [tag]命令保存到imagedisk磁盘文件中了。[tag]可以自己决定，只是为镜像起一个名字，如savevm img0。在保存后，使用info snapshots命令即可以看到所有保存的磁盘镜像。</p></li>
</ul>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(qemu)</span> <span class="go">info snapshots</span>
<span class="go">List of snapshots present on all disks:</span>
<span class="go">ID        TAG                     VM SIZE                DATE       VM CLOCK</span>
<span class="go">--        img0                   57.3 MiB 2022-03-16 01:50:22   00:00:26.950</span>
</pre></div>
</div>
<ul class="simple">
<li><p>在保存镜像至磁盘文件后，只要后面启动的时候在参数-hda后面带上这个磁盘文件，即可以通过loadvm [tag]的方式恢复保存的镜像，并回到保存时的机器状态进行使用了。</p></li>
</ul>
</div></blockquote>
</dd>
</dl>
</section>
<section id="gva2gpa-gpa2hpa-gpa2hva">
<h2>4、gva2gpa/gpa2hpa/gpa2hva<a class="headerlink" href="#gva2gpa-gpa2hpa-gpa2hva" title="Permalink to this headline">¶</a></h2>
<p>在调试裸机程序或者内核的时候，可能经常需要知道某块虚拟内存对应的物理地址，从而进行操作，在QEMU中，模拟器中guest的虚拟地址叫做gva，物理地址叫做gpa。而gva和gpa之间的转换关系在有些时候是很利于调试的。QEMU的monitor控制台提供了gva2gpa这个功能，让我们能把一个gva转换为对应的gpa。同时，还提供了gpa2hpa，gpa2hva两个功能，让我们可以将gpa转换为物理机眼中的物理地址或者虚拟地址，在需要的时候可以使用。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(qemu)</span> <span class="go">gva2gpa 0xffffffc0104d16c0</span>
<span class="go">gpa: 0x404d16c0</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="qemu_debug.html" class="btn btn-neutral float-left" title="QEMU调试" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../commit.html" class="btn btn-neutral float-right" title="代码提交指导" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, openEuler Embedded.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: openEuler-24.09
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Branches</dt>
      <dd><a href="../../../../master/developer_guide/debug/qemu/qemu_monitor.html">master</a></dd>
      <dd><a href="../../../../openEuler-21.09/index.html">openEuler-21.09</a></dd>
      <dd><a href="../../../../openEuler-22.03-LTS/index.html">openEuler-22.03-LTS</a></dd>
      <dd><a href="../../../../openEuler-22.03-LTS-SP1/index.html">openEuler-22.03-LTS-SP1</a></dd>
      <dd><a href="../../../../openEuler-22.03-LTS-SP2/index.html">openEuler-22.03-LTS-SP2</a></dd>
      <dd><a href="../../../../openEuler-22.03-LTS-SP3/index.html">openEuler-22.03-LTS-SP3</a></dd>
      <dd><a href="../../../../openEuler-22.03-LTS-SP4/index.html">openEuler-22.03-LTS-SP4</a></dd>
      <dd><a href="../../../../openEuler-22.09/index.html">openEuler-22.09</a></dd>
      <dd><a href="../../../../openEuler-23.03/index.html">openEuler-23.03</a></dd>
      <dd><a href="../../../../openEuler-23.09/index.html">openEuler-23.09</a></dd>
      <dd><a href="../../../../openEuler-24.03-LTS/developer_guide/debug/qemu/qemu_monitor.html">openEuler-24.03-LTS</a></dd>
      <dd><a href="qemu_monitor.html">openEuler-24.09</a></dd>
    </dl>
  </div>
</div>
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>